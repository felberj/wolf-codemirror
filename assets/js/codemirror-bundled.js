// Copyright (C) 2011 by Marijn Haverbeke <marijnh@gmail.com>
// All functions that need access to the editor's state live inside
// the CodeMirror function. Below that, at the bottom of the file,
// some utilities are defined.
// CodeMirror is the only global var we claim
var CodeMirror=function(){function CodeMirror(place,givenOptions){var options={},defaults=CodeMirror.defaults;for(var opt in defaults)defaults.hasOwnProperty(opt)&&(options[opt]=(givenOptions&&givenOptions.hasOwnProperty(opt)?givenOptions:defaults)[opt]);var wrapper=document.createElement("div");wrapper.className="CodeMirror"+(options.lineWrapping?" CodeMirror-wrap":""),wrapper.innerHTML='<div style="overflow: hidden; position: relative; width: 3px; height: 0px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll" tabindex="-1"><div style="position: relative"><div style="position: relative"><div class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative; z-index: 0"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre class="CodeMirror-cursor">&#160;</pre><div style="position: relative; z-index: -1"></div><div></div></div></div></div></div></div>',place.appendChild?place.appendChild(wrapper):place(wrapper);var inputDiv=wrapper.firstChild,input=inputDiv.firstChild,scroller=wrapper.lastChild,code=scroller.firstChild,mover=code.firstChild,gutter=mover.firstChild,gutterText=gutter.firstChild,lineSpace=gutter.nextSibling.firstChild,measure=lineSpace.firstChild,cursor=measure.nextSibling,selectionDiv=cursor.nextSibling,lineDiv=selectionDiv.nextSibling;themeChanged(),ios&&(input.style.width="0px"),webkit||(lineSpace.draggable=!0),lineSpace.style.outline="none",options.tabindex!=null&&(input.tabIndex=options.tabindex),!options.gutter&&!options.lineNumbers&&(gutter.style.display="none");try{stringWidth("x")}catch(e){throw e.message.match(/runtime/i)&&(e=new Error("A CodeMirror inside a P-style element does not work in Internet Explorer. (innerHTML bug)")),e}var poll=new Delayed,highlight=new Delayed,blinker,mode,doc=new BranchChunk([new LeafChunk([new Line("")])]),work,focused;loadMode();var sel={from:{line:0,ch:0},to:{line:0,ch:0},inverted:!1},shiftSelecting,lastClick,lastDoubleClick,lastScrollPos=0,draggingText,overwrite=!1,suppressEdits=!1,updateInput,userSelChange,changes,textChanged,selectionChanged,leaveInputAlone,gutterDirty,callbacks,displayOffset=0,showingFrom=0,showingTo=0,lastSizeC=0,bracketHighlighted,maxLine="",maxWidth,tabCache={};operation(function(){setValue(options.value||""),updateInput=!1})();var history=new History;connect(scroller,"mousedown",operation(onMouseDown)),connect(scroller,"dblclick",operation(onDoubleClick)),connect(lineSpace,"dragstart",onDragStart),connect(lineSpace,"selectstart",e_preventDefault),gecko||connect(scroller,"contextmenu",onContextMenu),connect(scroller,"scroll",function(){lastScrollPos=scroller.scrollTop,updateDisplay([]),options.fixedGutter&&(gutter.style.left=scroller.scrollLeft+"px"),options.onScroll&&options.onScroll(instance)}),connect(window,"resize",function(){updateDisplay(!0)}),connect(input,"keyup",operation(onKeyUp)),connect(input,"input",fastPoll),connect(input,"keydown",operation(onKeyDown)),connect(input,"keypress",operation(onKeyPress)),connect(input,"focus",onFocus),connect(input,"blur",onBlur),connect(scroller,"dragenter",e_stop),connect(scroller,"dragover",e_stop),connect(scroller,"drop",operation(onDrop)),connect(scroller,"paste",function(){focusInput(),fastPoll()}),connect(input,"paste",fastPoll),connect(input,"cut",operation(function(){options.readOnly||replaceSelection("")}));var hasFocus;try{hasFocus=document.activeElement==input}catch(e){}hasFocus?setTimeout(onFocus,20):onBlur();function isLine(l){return l>=0&&l<doc.size}var instance=wrapper.CodeMirror={getValue:getValue,setValue:operation(setValue),getSelection:getSelection,replaceSelection:operation(replaceSelection),focus:function(){window.focus(),focusInput(),onFocus(),fastPoll()},setOption:function(option,value){var oldVal=options[option];options[option]=value,option=="mode"||option=="indentUnit"?loadMode():option=="readOnly"&&value=="nocursor"?(onBlur(),input.blur()):option=="readOnly"&&!value?resetInput(!0):option=="theme"?themeChanged():option=="lineWrapping"&&oldVal!=value?operation(wrappingChanged)():option=="tabSize"&&updateDisplay(!0);if(option=="lineNumbers"||option=="gutter"||option=="firstLineNumber"||option=="theme")gutterChanged(),updateDisplay(!0)},getOption:function(option){return options[option]},undo:operation(undo),redo:operation(redo),indentLine:operation(function(n,dir){typeof dir!="string"&&(dir==null?dir=options.smartIndent?"smart":"prev":dir=dir?"add":"subtract"),isLine(n)&&indentLine(n,dir)}),indentSelection:operation(indentSelected),historySize:function(){return{undo:history.done.length,redo:history.undone.length}},clearHistory:function(){history=new History},matchBrackets:operation(function(){matchBrackets(!0)}),getTokenAt:operation(function(pos){return pos=clipPos(pos),getLine(pos.line).getTokenAt(mode,getStateBefore(pos.line),pos.ch)}),getStateAfter:function(line){return line=clipLine(line==null?doc.size-1:line),getStateBefore(line+1)},cursorCoords:function(start,mode){return start==null&&(start=sel.inverted),this.charCoords(start?sel.from:sel.to,mode)},charCoords:function(pos,mode){return pos=clipPos(pos),mode=="local"?localCoords(pos,!1):mode=="div"?localCoords(pos,!0):pageCoords(pos)},coordsChar:function(coords){var off=eltOffset(lineSpace);return coordsChar(coords.x-off.left,coords.y-off.top)},markText:operation(markText),setBookmark:setBookmark,setMarker:operation(addGutterMarker),clearMarker:operation(removeGutterMarker),setLineClass:operation(setLineClass),hideLine:operation(function(h){return setLineHidden(h,!0)}),showLine:operation(function(h){return setLineHidden(h,!1)}),onDeleteLine:function(line,f){if(typeof line=="number"){if(!isLine(line))return null;line=getLine(line)}return(line.handlers||(line.handlers=[])).push(f),line},lineInfo:lineInfo,addWidget:function(pos,node,scroll,vert,horiz){pos=localCoords(clipPos(pos));var top=pos.yBot,left=pos.x;node.style.position="absolute",code.appendChild(node);if(vert=="over")top=pos.y;else if(vert=="near"){var vspace=Math.max(scroller.offsetHeight,doc.height*textHeight()),hspace=Math.max(code.clientWidth,lineSpace.clientWidth)-paddingLeft();pos.yBot+node.offsetHeight>vspace&&pos.y>node.offsetHeight&&(top=pos.y-node.offsetHeight),left+node.offsetWidth>hspace&&(left=hspace-node.offsetWidth)}node.style.top=top+paddingTop()+"px",node.style.left=node.style.right="",horiz=="right"?(left=code.clientWidth-node.offsetWidth,node.style.right="0px"):(horiz=="left"?left=0:horiz=="middle"&&(left=(code.clientWidth-node.offsetWidth)/2),node.style.left=left+paddingLeft()+"px"),scroll&&scrollIntoView(left,top,left+node.offsetWidth,top+node.offsetHeight)},lineCount:function(){return doc.size},clipPos:clipPos,getCursor:function(start){return start==null&&(start=sel.inverted),copyPos(start?sel.from:sel.to)},somethingSelected:function(){return!posEq(sel.from,sel.to)},setCursor:operation(function(line,ch,user){ch==null&&typeof line.line=="number"?setCursor(line.line,line.ch,user):setCursor(line,ch,user)}),setSelection:operation(function(from,to,user){(user?setSelectionUser:setSelection)(clipPos(from),clipPos(to||from))}),getLine:function(line){if(isLine(line))return getLine(line).text},getLineHandle:function(line){if(isLine(line))return getLine(line)},setLine:operation(function(line,text){isLine(line)&&replaceRange(text,{line:line,ch:0},{line:line,ch:getLine(line).text.length})}),removeLine:operation(function(line){isLine(line)&&replaceRange("",{line:line,ch:0},clipPos({line:line+1,ch:0}))}),replaceRange:operation(replaceRange),getRange:function(from,to){return getRange(clipPos(from),clipPos(to))},triggerOnKeyDown:operation(onKeyDown),execCommand:function(cmd){return commands[cmd](instance)},moveH:operation(moveH),deleteH:operation(deleteH),moveV:operation(moveV),toggleOverwrite:function(){overwrite?(overwrite=!1,cursor.className=cursor.className.replace(" CodeMirror-overwrite","")):(overwrite=!0,cursor.className+=" CodeMirror-overwrite")},posFromIndex:function(off){var lineNo=0,ch;return doc.iter(0,doc.size,function(line){var sz=line.text.length+1;if(sz>off)return ch=off,!0;off-=sz,++lineNo}),clipPos({line:lineNo,ch:ch})},indexFromPos:function(coords){if(coords.line<0||coords.ch<0)return 0;var index=coords.ch;return doc.iter(0,coords.line,function(line){index+=line.text.length+1}),index},scrollTo:function(x,y){x!=null&&(scroller.scrollLeft=x),y!=null&&(scroller.scrollTop=y),updateDisplay([])},operation:function(f){return operation(f)()},refresh:function(){updateDisplay(!0),scroller.scrollHeight>lastScrollPos&&(scroller.scrollTop=lastScrollPos)},getInputField:function(){return input},getWrapperElement:function(){return wrapper},getScrollerElement:function(){return scroller},getGutterElement:function(){return gutter}};function getLine(n){return getLineAt(doc,n)}function updateLineHeight(line,height){gutterDirty=!0;var diff=height-line.height;for(var n=line;n;n=n.parent)n.height+=diff}function setValue(code){var top={line:0,ch:0};updateLines(top,{line:doc.size-1,ch:getLine(doc.size-1).text.length},splitLines(code),top,top),updateInput=!0}function getValue(code){var text=[];return doc.iter(0,doc.size,function(line){text.push(line.text)}),text.join("\n")}function onMouseDown(e){setShift(e_prop(e,"shiftKey"));for(var n=e_target(e);n!=wrapper;n=n.parentNode)if(n.parentNode==code&&n!=mover)return;for(var n=e_target(e);n!=wrapper;n=n.parentNode)if(n.parentNode==gutterText)return options.onGutterClick&&options.onGutterClick(instance,indexOf(gutterText.childNodes,n)+showingFrom,e),e_preventDefault(e);var start=posFromMouse(e);switch(e_button(e)){case 3:gecko&&!mac&&onContextMenu(e);return;case 2:start&&setCursor(start.line,start.ch,!0);return}if(!start){e_target(e)==scroller&&e_preventDefault(e);return}focused||onFocus();var now=+(new Date);if(lastDoubleClick&&lastDoubleClick.time>now-400&&posEq(lastDoubleClick.pos,start))return e_preventDefault(e),setTimeout(focusInput,20),selectLine(start.line);if(lastClick&&lastClick.time>now-400&&posEq(lastClick.pos,start))return lastDoubleClick={time:now,pos:start},e_preventDefault(e),selectWordAt(start);lastClick={time:now,pos:start};var last=start,going;if(dragAndDrop&&!options.readOnly&&!posEq(sel.from,sel.to)&&!posLess(start,sel.from)&&!posLess(sel.to,start)){webkit&&(lineSpace.draggable=!0);var up=connect(document,"mouseup",operation(function(e2){webkit&&(lineSpace.draggable=!1),draggingText=!1,up(),Math.abs(e.clientX-e2.clientX)+Math.abs(e.clientY-e2.clientY)<10&&(e_preventDefault(e2),setCursor(start.line,start.ch,!0),focusInput())}),!0);draggingText=!0,lineSpace.dragDrop&&lineSpace.dragDrop();return}e_preventDefault(e),setCursor(start.line,start.ch,!0);function extend(e){var cur=posFromMouse(e,!0);if(cur&&!posEq(cur,last)){focused||onFocus(),last=cur,setSelectionUser(start,cur),updateInput=!1;var visible=visibleLines();if(cur.line>=visible.to||cur.line<visible.from)going=setTimeout(operation(function(){extend(e)}),150)}}function done(e){clearTimeout(going);var cur=posFromMouse(e);cur&&setSelectionUser(start,cur),e_preventDefault(e),focusInput(),updateInput=!0,move(),up()}var move=connect(document,"mousemove",operation(function(e){clearTimeout(going),e_preventDefault(e),!ie&&!e_button(e)?done(e):extend(e)}),!0),up=connect(document,"mouseup",operation(done),!0)}function onDoubleClick(e){for(var n=e_target(e);n!=wrapper;n=n.parentNode)if(n.parentNode==gutterText)return e_preventDefault(e);var start=posFromMouse(e);if(!start)return;lastDoubleClick={time:+(new Date),pos:start},e_preventDefault(e),selectWordAt(start)}function onDrop(e){e.preventDefault();var pos=posFromMouse(e,!0),files=e.dataTransfer.files;if(!pos||options.readOnly)return;if(files&&files.length&&window.FileReader&&window.File){function loadFile(file,i){var reader=new FileReader;reader.onload=function(){text[i]=reader.result,++read==n&&(pos=clipPos(pos),operation(function(){var end=replaceRange(text.join(""),pos,pos);setSelectionUser(pos,end)})())},reader.readAsText(file)}var n=files.length,text=Array(n),read=0;for(var i=0;i<n;++i)loadFile(files[i],i)}else try{var text=e.dataTransfer.getData("Text");if(text){var curFrom=sel.from,curTo=sel.to;setSelectionUser(pos,pos),draggingText&&replaceRange("",curFrom,curTo),replaceSelection(text),focusInput()}}catch(e){}}function onDragStart(e){var txt=getSelection();e.dataTransfer.setData("Text",txt);if(gecko||chrome){var img=document.createElement("img");img.scr="data:image/gif;base64,R0lGODdhAgACAIAAAAAAAP///ywAAAAAAgACAAACAoRRADs=",e.dataTransfer.setDragImage(img,0,0)}}function doHandleBinding(bound,dropShift){if(typeof bound=="string"){bound=commands[bound];if(!bound)return!1}var prevShift=shiftSelecting;try{options.readOnly&&(suppressEdits=!0),dropShift&&(shiftSelecting=null),bound(instance)}catch(e){if(e!=Pass)throw e;return!1}finally{shiftSelecting=prevShift,suppressEdits=!1}return!0}function handleKeyBinding(e){var startMap=getKeyMap(options.keyMap),next=startMap.auto;clearTimeout(maybeTransition),next&&!isModifierKey(e)&&(maybeTransition=setTimeout(function(){getKeyMap(options.keyMap)==startMap&&(options.keyMap=next.call?next.call(null,instance):next)},50));var name=keyNames[e_prop(e,"keyCode")],handled=!1;return name==null||e.altGraphKey?!1:(e_prop(e,"altKey")&&(name="Alt-"+name),e_prop(e,"ctrlKey")&&(name="Ctrl-"+name),e_prop(e,"metaKey")&&(name="Cmd-"+name),e_prop(e,"shiftKey")?handled=lookupKey("Shift-"+name,options.extraKeys,options.keyMap,function(b){return doHandleBinding(b,!0)})||lookupKey(name,options.extraKeys,options.keyMap,function(b){if(typeof b=="string"&&/^go/.test(b))return doHandleBinding(b)}):handled=lookupKey(name,options.extraKeys,options.keyMap,doHandleBinding),handled&&(e_preventDefault(e),ie&&(e.oldKeyCode=e.keyCode,e.keyCode=0)),handled)}function handleCharBinding(e,ch){var handled=lookupKey("'"+ch+"'",options.extraKeys,options.keyMap,doHandleBinding);return handled&&e_preventDefault(e),handled}var lastStoppedKey=null,maybeTransition;function onKeyDown(e){focused||onFocus(),ie&&e.keyCode==27&&(e.returnValue=!1),pollingFast&&readInput()&&(pollingFast=!1);if(options.onKeyEvent&&options.onKeyEvent(instance,addStop(e)))return;var code=e_prop(e,"keyCode");setShift(code==16||e_prop(e,"shiftKey"));var handled=handleKeyBinding(e);window.opera&&(lastStoppedKey=handled?code:null,!handled&&code==88&&e_prop(e,mac?"metaKey":"ctrlKey")&&replaceSelection(""))}function onKeyPress(e){pollingFast&&readInput();if(options.onKeyEvent&&options.onKeyEvent(instance,addStop(e)))return;var keyCode=e_prop(e,"keyCode"),charCode=e_prop(e,"charCode");if(window.opera&&keyCode==lastStoppedKey){lastStoppedKey=null,e_preventDefault(e);return}if(window.opera&&!e.which&&handleKeyBinding(e))return;var ch=String.fromCharCode(charCode==null?keyCode:charCode);options.electricChars&&mode.electricChars&&options.smartIndent&&!options.readOnly&&mode.electricChars.indexOf(ch)>-1&&setTimeout(operation(function(){indentLine(sel.to.line,"smart")}),75);if(handleCharBinding(e,ch))return;fastPoll()}function onKeyUp(e){if(options.onKeyEvent&&options.onKeyEvent(instance,addStop(e)))return;e_prop(e,"keyCode")==16&&(shiftSelecting=null)}function onFocus(){if(options.readOnly=="nocursor")return;focused||(options.onFocus&&options.onFocus(instance),focused=!0,wrapper.className.search(/\bCodeMirror-focused\b/)==-1&&(wrapper.className+=" CodeMirror-focused"),leaveInputAlone||resetInput(!0)),slowPoll(),restartBlink()}function onBlur(){focused&&(options.onBlur&&options.onBlur(instance),focused=!1,bracketHighlighted&&operation(function(){bracketHighlighted&&(bracketHighlighted(),bracketHighlighted=null)})(),wrapper.className=wrapper.className.replace(" CodeMirror-focused","")),clearInterval(blinker),setTimeout(function(){focused||(shiftSelecting=null)},150)}function updateLines(from,to,newText,selFrom,selTo){if(suppressEdits)return;if(history){var old=[];doc.iter(from.line,to.line+1,function(line){old.push(line.text)}),history.addChange(from.line,newText.length,old);while(history.done.length>options.undoDepth)history.done.shift()}updateLinesNoUndo(from,to,newText,selFrom,selTo)}function unredoHelper(from,to){if(!from.length)return;var set=from.pop(),out=[];for(var i=set.length-1;i>=0;i-=1){var change=set[i],replaced=[],end=change.start+change.added;doc.iter(change.start,end,function(line){replaced.push(line.text)}),out.push({start:change.start,added:change.old.length,old:replaced});var pos=clipPos({line:change.start+change.old.length-1,ch:editEnd(replaced[replaced.length-1],change.old[change.old.length-1])});updateLinesNoUndo({line:change.start,ch:0},{line:end-1,ch:getLine(end-1).text.length},change.old,pos,pos)}updateInput=!0,to.push(out)}function undo(){unredoHelper(history.done,history.undone)}function redo(){unredoHelper(history.undone,history.done)}function updateLinesNoUndo(from,to,newText,selFrom,selTo){if(suppressEdits)return;var recomputeMaxLength=!1,maxLineLength=maxLine.length;options.lineWrapping||doc.iter(from.line,to.line,function(line){if(line.text.length==maxLineLength)return recomputeMaxLength=!0,!0});if(from.line!=to.line||newText.length>1)gutterDirty=!0;var nlines=to.line-from.line,firstLine=getLine(from.line),lastLine=getLine(to.line);if(from.ch==0&&to.ch==0&&newText[newText.length-1]==""){var added=[],prevLine=null;from.line?(prevLine=getLine(from.line-1),prevLine.fixMarkEnds(lastLine)):lastLine.fixMarkStarts();for(var i=0,e=newText.length-1;i<e;++i)added.push(Line.inheritMarks(newText[i],prevLine));nlines&&doc.remove(from.line,nlines,callbacks),added.length&&doc.insert(from.line,added)}else if(firstLine==lastLine)if(newText.length==1)firstLine.replace(from.ch,to.ch,newText[0]);else{lastLine=firstLine.split(to.ch,newText[newText.length-1]),firstLine.replace(from.ch,null,newText[0]),firstLine.fixMarkEnds(lastLine);var added=[];for(var i=1,e=newText.length-1;i<e;++i)added.push(Line.inheritMarks(newText[i],firstLine));added.push(lastLine),doc.insert(from.line+1,added)}else if(newText.length==1)firstLine.replace(from.ch,null,newText[0]),lastLine.replace(null,to.ch,""),firstLine.append(lastLine),doc.remove(from.line+1,nlines,callbacks);else{var added=[];firstLine.replace(from.ch,null,newText[0]),lastLine.replace(null,to.ch,newText[newText.length-1]),firstLine.fixMarkEnds(lastLine);for(var i=1,e=newText.length-1;i<e;++i)added.push(Line.inheritMarks(newText[i],firstLine));nlines>1&&doc.remove(from.line+1,nlines-1,callbacks),doc.insert(from.line+1,added)}if(options.lineWrapping){var perLine=scroller.clientWidth/charWidth()-3;doc.iter(from.line,from.line+newText.length,function(line){if(line.hidden)return;var guess=Math.ceil(line.text.length/perLine)||1;guess!=line.height&&updateLineHeight(line,guess)})}else doc.iter(from.line,i+newText.length,function(line){var l=line.text;l.length>maxLineLength&&(maxLine=l,maxLineLength=l.length,maxWidth=null,recomputeMaxLength=!1)}),recomputeMaxLength&&(maxLineLength=0,maxLine="",maxWidth=null,doc.iter(0,doc.size,function(line){var l=line.text;l.length>maxLineLength&&(maxLineLength=l.length,maxLine=l)}));var newWork=[],lendiff=newText.length-nlines-1;for(var i=0,l=work.length;i<l;++i){var task=work[i];task<from.line?newWork.push(task):task>to.line&&newWork.push(task+lendiff)}var hlEnd=from.line+Math.min(newText.length,500);highlightLines(from.line,hlEnd),newWork.push(hlEnd),work=newWork,startWorker(100),changes.push({from:from.line,to:to.line+1,diff:lendiff});var changeObj={from:from,to:to,text:newText};if(textChanged){for(var cur=textChanged;cur.next;cur=cur.next);cur.next=changeObj}else textChanged=changeObj;function updateLine(n){return n<=Math.min(to.line,to.line+lendiff)?n:n+lendiff}setSelection(selFrom,selTo,updateLine(sel.from.line),updateLine(sel.to.line)),scroller.clientHeight&&(code.style.height=doc.height*textHeight()+2*paddingTop()+"px")}function replaceRange(code,from,to){from=clipPos(from),to?to=clipPos(to):to=from,code=splitLines(code);function adjustPos(pos){if(posLess(pos,from))return pos;if(!posLess(to,pos))return end;var line=pos.line+code.length-(to.line-from.line)-1,ch=pos.ch;return pos.line==to.line&&(ch+=code[code.length-1].length-(to.ch-(to.line==from.line?from.ch:0))),{line:line,ch:ch}}var end;return replaceRange1(code,from,to,function(end1){return end=end1,{from:adjustPos(sel.from),to:adjustPos(sel.to)}}),end}function replaceSelection(code,collapse){replaceRange1(splitLines(code),sel.from,sel.to,function(end){return collapse=="end"?{from:end,to:end}:collapse=="start"?{from:sel.from,to:sel.from}:{from:sel.from,to:end}})}function replaceRange1(code,from,to,computeSel){var endch=code.length==1?code[0].length+from.ch:code[code.length-1].length,newSel=computeSel({line:from.line+code.length-1,ch:endch});updateLines(from,to,code,newSel.from,newSel.to)}function getRange(from,to){var l1=from.line,l2=to.line;if(l1==l2)return getLine(l1).text.slice(from.ch,to.ch);var code=[getLine(l1).text.slice(from.ch)];return doc.iter(l1+1,l2,function(line){code.push(line.text)}),code.push(getLine(l2).text.slice(0,to.ch)),code.join("\n")}function getSelection(){return getRange(sel.from,sel.to)}var pollingFast=!1;function slowPoll(){if(pollingFast)return;poll.set(options.pollInterval,function(){startOperation(),readInput(),focused&&slowPoll(),endOperation()})}function fastPoll(){var missed=!1;pollingFast=!0;function p(){startOperation();var changed=readInput();!changed&&!missed?(missed=!0,poll.set(60,p)):(pollingFast=!1,slowPoll()),endOperation()}poll.set(20,p)}var prevInput="";function readInput(){if(leaveInputAlone||!focused||hasSelection(input)||options.readOnly)return!1;var text=input.value;if(text==prevInput)return!1;shiftSelecting=null;var same=0,l=Math.min(prevInput.length,text.length);while(same<l&&prevInput[same]==text[same])++same;return same<prevInput.length?sel.from={line:sel.from.line,ch:sel.from.ch-(prevInput.length-same)}:overwrite&&posEq(sel.from,sel.to)&&(sel.to={line:sel.to.line,ch:Math.min(getLine(sel.to.line).text.length,sel.to.ch+(text.length-same))}),replaceSelection(text.slice(same),"end"),prevInput=text,!0}function resetInput(user){posEq(sel.from,sel.to)?user&&(prevInput=input.value=""):(prevInput="",input.value=getSelection(),selectInput(input))}function focusInput(){options.readOnly!="nocursor"&&input.focus()}function scrollEditorIntoView(){if(!cursor.getBoundingClientRect)return;var rect=cursor.getBoundingClientRect();if(ie&&rect.top==rect.bottom)return;var winH=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(rect.top<0||rect.bottom>winH)&&cursor.scrollIntoView()}function scrollCursorIntoView(){var cursor=localCoords(sel.inverted?sel.from:sel.to),x=options.lineWrapping?Math.min(cursor.x,lineSpace.offsetWidth):cursor.x;return scrollIntoView(x,cursor.y,x,cursor.yBot)}function scrollIntoView(x1,y1,x2,y2){var pl=paddingLeft(),pt=paddingTop(),lh=textHeight();y1+=pt,y2+=pt,x1+=pl,x2+=pl;var screen=scroller.clientHeight,screentop=scroller.scrollTop,scrolled=!1,result=!0;y1<screentop?(scroller.scrollTop=Math.max(0,y1-2*lh),scrolled=!0):y2>screentop+screen&&(scroller.scrollTop=y2+lh-screen,scrolled=!0);var screenw=scroller.clientWidth,screenleft=scroller.scrollLeft,gutterw=options.fixedGutter?gutter.clientWidth:0;return x1<screenleft+gutterw?(x1<50&&(x1=0),scroller.scrollLeft=Math.max(0,x1-10-gutterw),scrolled=!0):x2>screenw+screenleft-3&&(scroller.scrollLeft=x2+10-screenw,scrolled=!0,x2>code.clientWidth&&(result=!1)),scrolled&&options.onScroll&&options.onScroll(instance),result}function visibleLines(){var lh=textHeight(),top=scroller.scrollTop-paddingTop(),from_height=Math.max(0,Math.floor(top/lh)),to_height=Math.ceil((top+scroller.clientHeight)/lh);return{from:lineAtHeight(doc,from_height),to:lineAtHeight(doc,to_height)}}function updateDisplay(changes,suppressCallback){if(!scroller.clientWidth){showingFrom=showingTo=displayOffset=0;return}var visible=visibleLines();if(changes!==!0&&changes.length==0&&visible.from>showingFrom&&visible.to<showingTo)return;var from=Math.max(visible.from-100,0),to=Math.min(doc.size,visible.to+100);showingFrom<from&&from-showingFrom<20&&(from=showingFrom),showingTo>to&&showingTo-to<20&&(to=Math.min(doc.size,showingTo));var intact=changes===!0?[]:computeIntact([{from:showingFrom,to:showingTo,domStart:0}],changes),intactLines=0;for(var i=0;i<intact.length;++i){var range=intact[i];range.from<from&&(range.domStart+=from-range.from,range.from=from),range.to>to&&(range.to=to),range.from>=range.to?intact.splice(i--,1):intactLines+=range.to-range.from}if(intactLines==to-from)return;intact.sort(function(a,b){return a.domStart-b.domStart});var th=textHeight(),gutterDisplay=gutter.style.display;lineDiv.style.display="none",patchDisplay(from,to,intact),lineDiv.style.display=gutter.style.display="";var different=from!=showingFrom||to!=showingTo||lastSizeC!=scroller.clientHeight+th;different&&(lastSizeC=scroller.clientHeight+th),showingFrom=from,showingTo=to,displayOffset=heightAtLine(doc,from),mover.style.top=displayOffset*th+"px",scroller.clientHeight&&(code.style.height=doc.height*th+2*paddingTop()+"px");if(lineDiv.childNodes.length!=showingTo-showingFrom)throw new Error("BAD PATCH! "+JSON.stringify(intact)+" size="+(showingTo-showingFrom)+" nodes="+lineDiv.childNodes.length);if(options.lineWrapping){maxWidth=scroller.clientWidth;var curNode=lineDiv.firstChild,heightChanged=!1;doc.iter(showingFrom,showingTo,function(line){if(!line.hidden){var height=Math.round(curNode.offsetHeight/th)||1;line.height!=height&&(updateLineHeight(line,height),gutterDirty=heightChanged=!0)}curNode=curNode.nextSibling}),heightChanged&&(code.style.height=doc.height*th+2*paddingTop()+"px")}else maxWidth==null&&(maxWidth=stringWidth(maxLine)),maxWidth>scroller.clientWidth?(lineSpace.style.width=maxWidth+"px",code.style.width="",code.style.width=scroller.scrollWidth+"px"):lineSpace.style.width=code.style.width="";return gutter.style.display=gutterDisplay,(different||gutterDirty)&&updateGutter(),updateSelection(),!suppressCallback&&options.onUpdate&&options.onUpdate(instance),!0}function computeIntact(intact,changes){for(var i=0,l=changes.length||0;i<l;++i){var change=changes[i],intact2=[],diff=change.diff||0;for(var j=0,l2=intact.length;j<l2;++j){var range=intact[j];change.to<=range.from&&change.diff?intact2.push({from:range.from+diff,to:range.to+diff,domStart:range.domStart}):change.to<=range.from||change.from>=range.to?intact2.push(range):(change.from>range.from&&intact2.push({from:range.from,to:change.from,domStart:range.domStart}),change.to<range.to&&intact2.push({from:change.to+diff,to:range.to+diff,domStart:range.domStart+(change.to-range.from)}))}intact=intact2}return intact}function patchDisplay(from,to,intact){if(!intact.length)lineDiv.innerHTML="";else{function killNode(node){var tmp=node.nextSibling;return node.parentNode.removeChild(node),tmp}var domPos=0,curNode=lineDiv.firstChild,n;for(var i=0;i<intact.length;++i){var cur=intact[i];while(cur.domStart>domPos)curNode=killNode(curNode),domPos++;for(var j=0,e=cur.to-cur.from;j<e;++j)curNode=curNode.nextSibling,domPos++}while(curNode)curNode=killNode(curNode)}var nextIntact=intact.shift(),curNode=lineDiv.firstChild,j=from,scratch=document.createElement("div"),newElt;doc.iter(from,to,function(line){nextIntact&&nextIntact.to==j&&(nextIntact=intact.shift());if(!nextIntact||nextIntact.from>j){if(line.hidden)var html=scratch.innerHTML="<pre></pre>";else{var html="<pre"+(line.className?' class="'+line.className+'"':"")+">"+line.getHTML(makeTab)+"</pre>";line.bgClassName&&(html='<div style="position: relative"><pre class="'+line.bgClassName+'" style="position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: -2">&#160;</pre>'+html+"</div>")}scratch.innerHTML=html,lineDiv.insertBefore(scratch.firstChild,curNode)}else curNode=curNode.nextSibling;++j})}function updateGutter(){if(!options.gutter&&!options.lineNumbers)return;var hText=mover.offsetHeight,hEditor=scroller.clientHeight;gutter.style.height=(hText-hEditor<2?hEditor:hText)+"px";var html=[],i=showingFrom,normalNode;doc.iter(showingFrom,Math.max(showingTo,showingFrom+1),function(line){if(line.hidden)html.push("<pre></pre>");else{var marker=line.gutterMarker,text=options.lineNumbers?i+options.firstLineNumber:null;marker&&marker.text?text=marker.text.replace("%N%",text!=null?text:""):text==null&&(text=" "),html.push(marker&&marker.style?'<pre class="'+marker.style+'">':"<pre>",text);for(var j=1;j<line.height;++j)html.push("<br/>&#160;");html.push("</pre>"),marker||(normalNode=i)}++i}),gutter.style.display="none",gutterText.innerHTML=html.join("");if(normalNode!=null){var node=gutterText.childNodes[normalNode-showingFrom],minwidth=String(doc.size).length,val=eltText(node),pad="";while(val.length+pad.length<minwidth)pad+=" ";pad&&node.insertBefore(document.createTextNode(pad),node.firstChild)}gutter.style.display="",lineSpace.style.marginLeft=gutter.offsetWidth+"px",gutterDirty=!1}function updateSelection(){var collapsed=posEq(sel.from,sel.to),fromPos=localCoords(sel.from,!0),toPos=collapsed?fromPos:localCoords(sel.to,!0),headPos=sel.inverted?fromPos:toPos,th=textHeight(),wrapOff=eltOffset(wrapper),lineOff=eltOffset(lineDiv);inputDiv.style.top=Math.max(0,Math.min(scroller.offsetHeight,headPos.y+lineOff.top-wrapOff.top))+"px",inputDiv.style.left=Math.max(0,Math.min(scroller.offsetWidth,headPos.x+lineOff.left-wrapOff.left))+"px";if(collapsed)cursor.style.top=headPos.y+"px",cursor.style.left=(options.lineWrapping?Math.min(headPos.x,lineSpace.offsetWidth):headPos.x)+"px",cursor.style.display="",selectionDiv.style.display="none";else{var sameLine=fromPos.y==toPos.y,html="";function add(left,top,right,height){html+='<div class="CodeMirror-selected" style="position: absolute; left: '+left+"px; top: "+top+"px; right: "+right+"px; height: "+height+'px"></div>'}if(sel.from.ch&&fromPos.y>=0){var right=sameLine?lineSpace.clientWidth-toPos.x:0;add(fromPos.x,fromPos.y,right,th)}var middleStart=Math.max(0,fromPos.y+(sel.from.ch?th:0)),middleHeight=Math.min(toPos.y,lineSpace.clientHeight)-middleStart;middleHeight>.2*th&&add(0,middleStart,0,middleHeight),(!sameLine||!sel.from.ch)&&toPos.y<lineSpace.clientHeight-.5*th&&add(0,toPos.y,lineSpace.clientWidth-toPos.x,th),selectionDiv.innerHTML=html,cursor.style.display="none",selectionDiv.style.display=""}}function setShift(val){val?shiftSelecting=shiftSelecting||(sel.inverted?sel.to:sel.from):shiftSelecting=null}function setSelectionUser(from,to){var sh=shiftSelecting&&clipPos(shiftSelecting);sh&&(posLess(sh,from)?from=sh:posLess(to,sh)&&(to=sh)),setSelection(from,to),userSelChange=!0}function setSelection(from,to,oldFrom,oldTo){goalColumn=null,oldFrom==null&&(oldFrom=sel.from.line,oldTo=sel.to.line);if(posEq(sel.from,from)&&posEq(sel.to,to))return;if(posLess(to,from)){var tmp=to;to=from,from=tmp}from.line!=oldFrom&&(from=skipHidden(from,oldFrom,sel.from.ch)),to.line!=oldTo&&(to=skipHidden(to,oldTo,sel.to.ch)),posEq(from,to)?sel.inverted=!1:posEq(from,sel.to)?sel.inverted=!1:posEq(to,sel.from)&&(sel.inverted=!0);if(options.autoClearEmptyLines&&posEq(sel.from,sel.to)){var head=sel.inverted?from:to;if(head.line!=sel.from.line){var oldLine=getLine(sel.from.line);/^\s+$/.test(oldLine.text)&&setTimeout(operation(function(){if(oldLine.parent&&/^\s+$/.test(oldLine.text)){var no=lineNo(oldLine);replaceRange("",{line:no,ch:0},{line:no,ch:oldLine.text.length})}},10))}}sel.from=from,sel.to=to,selectionChanged=!0}function skipHidden(pos,oldLine,oldCh){function getNonHidden(dir){var lNo=pos.line+dir,end=dir==1?doc.size:-1;while(lNo!=end){var line=getLine(lNo);if(!line.hidden){var ch=pos.ch;if(ch>oldCh||ch>line.text.length)ch=line.text.length;return{line:lNo,ch:ch}}lNo+=dir}}var line=getLine(pos.line);return line.hidden?pos.line>=oldLine?getNonHidden(1)||getNonHidden(-1):getNonHidden(-1)||getNonHidden(1):pos}function setCursor(line,ch,user){var pos=clipPos({line:line,ch:ch||0});(user?setSelectionUser:setSelection)(pos,pos)}function clipLine(n){return Math.max(0,Math.min(n,doc.size-1))}function clipPos(pos){if(pos.line<0)return{line:0,ch:0};if(pos.line>=doc.size)return{line:doc.size-1,ch:getLine(doc.size-1).text.length};var ch=pos.ch,linelen=getLine(pos.line).text.length;return ch==null||ch>linelen?{line:pos.line,ch:linelen}:ch<0?{line:pos.line,ch:0}:pos}function findPosH(dir,unit){var end=sel.inverted?sel.from:sel.to,line=end.line,ch=end.ch,lineObj=getLine(line);function findNextLine(){for(var l=line+dir,e=dir<0?-1:doc.size;l!=e;l+=dir){var lo=getLine(l);if(!lo.hidden)return line=
l,lineObj=lo,!0}}function moveOnce(boundToLine){if(ch==(dir<0?0:lineObj.text.length)){if(!!boundToLine||!findNextLine())return!1;ch=dir<0?lineObj.text.length:0}else ch+=dir;return!0}if(unit=="char")moveOnce();else if(unit=="column")moveOnce(!0);else if(unit=="word"){var sawWord=!1;for(;;){if(dir<0&&!moveOnce())break;if(isWordChar(lineObj.text.charAt(ch)))sawWord=!0;else if(sawWord){dir<0&&(dir=1,moveOnce());break}if(dir>0&&!moveOnce())break}}return{line:line,ch:ch}}function moveH(dir,unit){var pos=dir<0?sel.from:sel.to;if(shiftSelecting||posEq(sel.from,sel.to))pos=findPosH(dir,unit);setCursor(pos.line,pos.ch,!0)}function deleteH(dir,unit){posEq(sel.from,sel.to)?dir<0?replaceRange("",findPosH(dir,unit),sel.to):replaceRange("",sel.from,findPosH(dir,unit)):replaceRange("",sel.from,sel.to),userSelChange=!0}var goalColumn=null;function moveV(dir,unit){var dist=0,pos=localCoords(sel.inverted?sel.from:sel.to,!0);goalColumn!=null&&(pos.x=goalColumn),unit=="page"?dist=Math.min(scroller.clientHeight,window.innerHeight||document.documentElement.clientHeight):unit=="line"&&(dist=textHeight());var target=coordsChar(pos.x,pos.y+dist*dir+2);setCursor(target.line,target.ch,!0),goalColumn=pos.x}function selectWordAt(pos){var line=getLine(pos.line).text,start=pos.ch,end=pos.ch;while(start>0&&isWordChar(line.charAt(start-1)))--start;while(end<line.length&&isWordChar(line.charAt(end)))++end;setSelectionUser({line:pos.line,ch:start},{line:pos.line,ch:end})}function selectLine(line){setSelectionUser({line:line,ch:0},clipPos({line:line+1,ch:0}))}function indentSelected(mode){if(posEq(sel.from,sel.to))return indentLine(sel.from.line,mode);var e=sel.to.line-(sel.to.ch?0:1);for(var i=sel.from.line;i<=e;++i)indentLine(i,mode)}function indentLine(n,how){how||(how="add");if(how=="smart")if(!mode.indent)how="prev";else var state=getStateBefore(n);var line=getLine(n),curSpace=line.indentation(options.tabSize),curSpaceString=line.text.match(/^\s*/)[0],indentation;how=="prev"?n?indentation=getLine(n-1).indentation(options.tabSize):indentation=0:how=="smart"?indentation=mode.indent(state,line.text.slice(curSpaceString.length),line.text):how=="add"?indentation=curSpace+options.indentUnit:how=="subtract"&&(indentation=curSpace-options.indentUnit),indentation=Math.max(0,indentation);var diff=indentation-curSpace;if(!diff){if(sel.from.line!=n&&sel.to.line!=n)return;var indentString=curSpaceString}else{var indentString="",pos=0;if(options.indentWithTabs)for(var i=Math.floor(indentation/options.tabSize);i;--i)pos+=options.tabSize,indentString+="\t";while(pos<indentation)++pos,indentString+=" "}replaceRange(indentString,{line:n,ch:0},{line:n,ch:curSpaceString.length})}function loadMode(){mode=CodeMirror.getMode(options,options.mode),doc.iter(0,doc.size,function(line){line.stateAfter=null}),work=[0],startWorker()}function gutterChanged(){var visible=options.gutter||options.lineNumbers;gutter.style.display=visible?"":"none",visible?gutterDirty=!0:lineDiv.parentNode.style.marginLeft=0}function wrappingChanged(from,to){if(options.lineWrapping){wrapper.className+=" CodeMirror-wrap";var perLine=scroller.clientWidth/charWidth()-3;doc.iter(0,doc.size,function(line){if(line.hidden)return;var guess=Math.ceil(line.text.length/perLine)||1;guess!=1&&updateLineHeight(line,guess)}),lineSpace.style.width=code.style.width=""}else wrapper.className=wrapper.className.replace(" CodeMirror-wrap",""),maxWidth=null,maxLine="",doc.iter(0,doc.size,function(line){line.height!=1&&!line.hidden&&updateLineHeight(line,1),line.text.length>maxLine.length&&(maxLine=line.text)});changes.push({from:0,to:doc.size})}function makeTab(col){var w=options.tabSize-col%options.tabSize,cached=tabCache[w];if(cached)return cached;for(var str='<span class="cm-tab">',i=0;i<w;++i)str+=" ";return tabCache[w]={html:str+"</span>",width:w}}function themeChanged(){scroller.className=scroller.className.replace(/\s*cm-s-\w+/g,"")+options.theme.replace(/(^|\s)\s*/g," cm-s-")}function TextMarker(){this.set=[]}TextMarker.prototype.clear=operation(function(){var min=Infinity,max=-Infinity;for(var i=0,e=this.set.length;i<e;++i){var line=this.set[i],mk=line.marked;if(!mk||!line.parent)continue;var lineN=lineNo(line);min=Math.min(min,lineN),max=Math.max(max,lineN);for(var j=0;j<mk.length;++j)mk[j].set==this.set&&mk.splice(j--,1)}min!=Infinity&&changes.push({from:min,to:max+1})}),TextMarker.prototype.find=function(){var from,to;for(var i=0,e=this.set.length;i<e;++i){var line=this.set[i],mk=line.marked;for(var j=0;j<mk.length;++j){var mark=mk[j];if(mark.set==this.set)if(mark.from!=null||mark.to!=null){var found=lineNo(line);found!=null&&(mark.from!=null&&(from={line:found,ch:mark.from}),mark.to!=null&&(to={line:found,ch:mark.to}))}}}return{from:from,to:to}};function markText(from,to,className){from=clipPos(from),to=clipPos(to);var tm=new TextMarker;if(!posLess(from,to))return tm;function add(line,from,to,className){getLine(line).addMark(new MarkedText(from,to,className,tm.set))}if(from.line==to.line)add(from.line,from.ch,to.ch,className);else{add(from.line,from.ch,null,className);for(var i=from.line+1,e=to.line;i<e;++i)add(i,null,null,className);add(to.line,null,to.ch,className)}return changes.push({from:from.line,to:to.line+1}),tm}function setBookmark(pos){pos=clipPos(pos);var bm=new Bookmark(pos.ch);return getLine(pos.line).addMark(bm),bm}function addGutterMarker(line,text,className){return typeof line=="number"&&(line=getLine(clipLine(line))),line.gutterMarker={text:text,style:className},gutterDirty=!0,line}function removeGutterMarker(line){typeof line=="number"&&(line=getLine(clipLine(line))),line.gutterMarker=null,gutterDirty=!0}function changeLine(handle,op){var no=handle,line=handle;return typeof handle=="number"?line=getLine(clipLine(handle)):no=lineNo(handle),no==null?null:op(line,no)?(changes.push({from:no,to:no+1}),line):null}function setLineClass(handle,className,bgClassName){return changeLine(handle,function(line){if(line.className!=className||line.bgClassName!=bgClassName)return line.className=className,line.bgClassName=bgClassName,!0})}function setLineHidden(handle,hidden){return changeLine(handle,function(line,no){if(line.hidden!=hidden){line.hidden=hidden,updateLineHeight(line,hidden?0:1);var fline=sel.from.line,tline=sel.to.line;if(hidden&&(fline==no||tline==no)){var from=fline==no?skipHidden({line:fline,ch:0},fline,0):sel.from,to=tline==no?skipHidden({line:tline,ch:0},tline,0):sel.to;setSelection(from,to)}return gutterDirty=!0}})}function lineInfo(line){if(typeof line=="number"){if(!isLine(line))return null;var n=line;line=getLine(line);if(!line)return null}else{var n=lineNo(line);if(n==null)return null}var marker=line.gutterMarker;return{line:n,handle:line,text:line.text,markerText:marker&&marker.text,markerClass:marker&&marker.style,lineClass:line.className,bgClass:line.bgClassName}}function stringWidth(str){return measure.innerHTML="<pre><span>x</span></pre>",measure.firstChild.firstChild.firstChild.nodeValue=str,measure.firstChild.firstChild.offsetWidth||10}function charFromX(line,x){if(x<=0)return 0;var lineObj=getLine(line),text=lineObj.text;function getX(len){return measure.innerHTML="<pre><span>"+lineObj.getHTML(makeTab,len)+"</span></pre>",measure.firstChild.firstChild.offsetWidth}var from=0,fromX=0,to=text.length,toX,estimated=Math.min(to,Math.ceil(x/charWidth()));for(;;){var estX=getX(estimated);if(!(estX<=x&&estimated<to)){toX=estX,to=estimated;break}estimated=Math.min(to,Math.ceil(estimated*1.2))}if(x>toX)return to;estimated=Math.floor(to*.8),estX=getX(estimated),estX<x&&(from=estimated,fromX=estX);for(;;){if(to-from<=1)return toX-x>x-fromX?from:to;var middle=Math.ceil((from+to)/2),middleX=getX(middle);middleX>x?(to=middle,toX=middleX):(from=middle,fromX=middleX)}}var tempId=Math.floor(Math.random()*16777215).toString(16);function measureLine(line,ch){if(ch==0)return{top:0,left:0};var extra="";if(options.lineWrapping){var end=line.text.indexOf(" ",ch+6);extra=htmlEscape(line.text.slice(ch+1,end<0?line.text.length:end+(ie?5:0)))}measure.innerHTML="<pre>"+line.getHTML(makeTab,ch)+'<span id="CodeMirror-temp-'+tempId+'">'+htmlEscape(line.text.charAt(ch)||" ")+"</span>"+extra+"</pre>";var elt=document.getElementById("CodeMirror-temp-"+tempId),top=elt.offsetTop,left=elt.offsetLeft;if(ie&&top==0&&left==0){var backup=document.createElement("span");backup.innerHTML="x",elt.parentNode.insertBefore(backup,elt.nextSibling),top=backup.offsetTop}return{top:top,left:left}}function localCoords(pos,inLineWrap){var x,lh=textHeight(),y=lh*(heightAtLine(doc,pos.line)-(inLineWrap?displayOffset:0));if(pos.ch==0)x=0;else{var sp=measureLine(getLine(pos.line),pos.ch);x=sp.left,options.lineWrapping&&(y+=Math.max(0,sp.top))}return{x:x,y:y,yBot:y+lh}}function coordsChar(x,y){y<0&&(y=0);var th=textHeight(),cw=charWidth(),heightPos=displayOffset+Math.floor(y/th),lineNo=lineAtHeight(doc,heightPos);if(lineNo>=doc.size)return{line:doc.size-1,ch:getLine(doc.size-1).text.length};var lineObj=getLine(lineNo),text=lineObj.text,tw=options.lineWrapping,innerOff=tw?heightPos-heightAtLine(doc,lineNo):0;if(x<=0&&innerOff==0)return{line:lineNo,ch:0};function getX(len){var sp=measureLine(lineObj,len);if(tw){var off=Math.round(sp.top/th);return Math.max(0,sp.left+(off-innerOff)*scroller.clientWidth)}return sp.left}var from=0,fromX=0,to=text.length,toX,estimated=Math.min(to,Math.ceil((x+innerOff*scroller.clientWidth*.9)/cw));for(;;){var estX=getX(estimated);if(!(estX<=x&&estimated<to)){toX=estX,to=estimated;break}estimated=Math.min(to,Math.ceil(estimated*1.2))}if(x>toX)return{line:lineNo,ch:to};estimated=Math.floor(to*.8),estX=getX(estimated),estX<x&&(from=estimated,fromX=estX);for(;;){if(to-from<=1)return{line:lineNo,ch:toX-x>x-fromX?from:to};var middle=Math.ceil((from+to)/2),middleX=getX(middle);middleX>x?(to=middle,toX=middleX):(from=middle,fromX=middleX)}}function pageCoords(pos){var local=localCoords(pos,!0),off=eltOffset(lineSpace);return{x:off.left+local.x,y:off.top+local.y,yBot:off.top+local.yBot}}var cachedHeight,cachedHeightFor,measureText;function textHeight(){if(measureText==null){measureText="<pre>";for(var i=0;i<49;++i)measureText+="x<br/>";measureText+="x</pre>"}var offsetHeight=lineDiv.clientHeight;return offsetHeight==cachedHeightFor?cachedHeight:(cachedHeightFor=offsetHeight,measure.innerHTML=measureText,cachedHeight=measure.firstChild.offsetHeight/50||1,measure.innerHTML="",cachedHeight)}var cachedWidth,cachedWidthFor=0;function charWidth(){return scroller.clientWidth==cachedWidthFor?cachedWidth:(cachedWidthFor=scroller.clientWidth,cachedWidth=stringWidth("x"))}function paddingTop(){return lineSpace.offsetTop}function paddingLeft(){return lineSpace.offsetLeft}function posFromMouse(e,liberal){var offW=eltOffset(scroller,!0),x,y;try{x=e.clientX,y=e.clientY}catch(e){return null}if(!liberal&&(x-offW.left>scroller.clientWidth||y-offW.top>scroller.clientHeight))return null;var offL=eltOffset(lineSpace,!0);return coordsChar(x-offL.left,y-offL.top)}function onContextMenu(e){var pos=posFromMouse(e),scrollPos=scroller.scrollTop;if(!pos||window.opera)return;(posEq(sel.from,sel.to)||posLess(pos,sel.from)||!posLess(pos,sel.to))&&operation(setCursor)(pos.line,pos.ch);var oldCSS=input.style.cssText;inputDiv.style.position="absolute",input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(e.clientY-5)+"px; left: "+(e.clientX-5)+"px; z-index: 1000; background: white; "+"border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",leaveInputAlone=!0;var val=input.value=getSelection();focusInput(),selectInput(input);function rehide(){var newVal=splitLines(input.value).join("\n");newVal!=val&&operation(replaceSelection)(newVal,"end"),inputDiv.style.position="relative",input.style.cssText=oldCSS,ie_lt9&&(scroller.scrollTop=scrollPos),leaveInputAlone=!1,resetInput(!0),slowPoll()}if(gecko){e_stop(e);var mouseup=connect(window,"mouseup",function(){mouseup(),setTimeout(rehide,20)},!0)}else setTimeout(rehide,50)}function restartBlink(){clearInterval(blinker);var on=!0;cursor.style.visibility="",blinker=setInterval(function(){cursor.style.visibility=(on=!on)?"":"hidden"},650)}var matching={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function matchBrackets(autoclear){var head=sel.inverted?sel.from:sel.to,line=getLine(head.line),pos=head.ch-1,match=pos>=0&&matching[line.text.charAt(pos)]||matching[line.text.charAt(++pos)];if(!match)return;var ch=match.charAt(0),forward=match.charAt(1)==">",d=forward?1:-1,st=line.styles;for(var off=pos+1,i=0,e=st.length;i<e;i+=2)if((off-=st[i].length)<=0){var style=st[i+1];break}var stack=[line.text.charAt(pos)],re=/[(){}[\]]/;function scan(line,from,to){if(!line.text)return;var st=line.styles,pos=forward?0:line.text.length-1,cur;for(var i=forward?0:st.length-2,e=forward?st.length:-2;i!=e;i+=2*d){var text=st[i];if(st[i+1]!=null&&st[i+1]!=style){pos+=d*text.length;continue}for(var j=forward?0:text.length-1,te=forward?text.length:-1;j!=te;j+=d,pos+=d)if(pos>=from&&pos<to&&re.test(cur=text.charAt(j))){var match=matching[cur];if(match.charAt(1)==">"==forward)stack.push(cur);else{if(stack.pop()!=match.charAt(0))return{pos:pos,match:!1};if(!stack.length)return{pos:pos,match:!0}}}}}for(var i=head.line,e=forward?Math.min(i+100,doc.size):Math.max(-1,i-100);i!=e;i+=d){var line=getLine(i),first=i==head.line,found=scan(line,first&&forward?pos+1:0,first&&!forward?pos:line.text.length);if(found)break}found||(found={pos:null,match:!1});var style=found.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",one=markText({line:head.line,ch:pos},{line:head.line,ch:pos+1},style),two=found.pos!=null&&markText({line:i,ch:found.pos},{line:i,ch:found.pos+1},style),clear=operation(function(){one.clear(),two&&two.clear()});autoclear?setTimeout(clear,800):bracketHighlighted=clear}function findStartLine(n){var minindent,minline;for(var search=n,lim=n-40;search>lim;--search){if(search==0)return 0;var line=getLine(search-1);if(line.stateAfter)return search;var indented=line.indentation(options.tabSize);if(minline==null||minindent>indented)minline=search-1,minindent=indented}return minline}function getStateBefore(n){var start=findStartLine(n),state=start&&getLine(start-1).stateAfter;return state?state=copyState(mode,state):state=startState(mode),doc.iter(start,n,function(line){line.highlight(mode,state,options.tabSize),line.stateAfter=copyState(mode,state)}),start<n&&changes.push({from:start,to:n}),n<doc.size&&!getLine(n).stateAfter&&work.push(n),state}function highlightLines(start,end){var state=getStateBefore(start);doc.iter(start,end,function(line){line.highlight(mode,state,options.tabSize),line.stateAfter=copyState(mode,state)})}function highlightWorker(){var end=+(new Date)+options.workTime,foundWork=work.length;while(work.length){if(!getLine(showingFrom).stateAfter)var task=showingFrom;else var task=work.pop();if(task>=doc.size)continue;var start=findStartLine(task),state=start&&getLine(start-1).stateAfter;state?state=copyState(mode,state):state=startState(mode);var unchanged=0,compare=mode.compareStates,realChange=!1,i=start,bail=!1;doc.iter(i,doc.size,function(line){var hadState=line.stateAfter;if(+(new Date)>end)return work.push(i),startWorker(options.workDelay),realChange&&changes.push({from:task,to:i+1}),bail=!0;var changed=line.highlight(mode,state,options.tabSize);changed&&(realChange=!0),line.stateAfter=copyState(mode,state);if(compare){if(hadState&&compare(hadState,state))return!0}else if(changed!==!1||!hadState)unchanged=0;else if(++unchanged>3&&(!mode.indent||mode.indent(hadState,"")==mode.indent(state,"")))return!0;++i});if(bail)return;realChange&&changes.push({from:task,to:i+1})}foundWork&&options.onHighlightComplete&&options.onHighlightComplete(instance)}function startWorker(time){if(!work.length)return;highlight.set(time,operation(highlightWorker))}function startOperation(){updateInput=userSelChange=textChanged=null,changes=[],selectionChanged=!1,callbacks=[]}function endOperation(){var reScroll=!1,updated;selectionChanged&&(reScroll=!scrollCursorIntoView()),changes.length?updated=updateDisplay(changes,!0):(selectionChanged&&updateSelection(),gutterDirty&&updateGutter()),reScroll&&scrollCursorIntoView(),selectionChanged&&(scrollEditorIntoView(),restartBlink()),focused&&!leaveInputAlone&&(updateInput===!0||updateInput!==!1&&selectionChanged)&&resetInput(userSelChange),selectionChanged&&options.matchBrackets&&setTimeout(operation(function(){bracketHighlighted&&(bracketHighlighted(),bracketHighlighted=null),posEq(sel.from,sel.to)&&matchBrackets(!1)}),20);var tc=textChanged,cbs=callbacks;selectionChanged&&options.onCursorActivity&&options.onCursorActivity(instance),tc&&options.onChange&&instance&&options.onChange(instance,tc);for(var i=0;i<cbs.length;++i)cbs[i](instance);updated&&options.onUpdate&&options.onUpdate(instance)}var nestedOperation=0;function operation(f){return function(){nestedOperation++||startOperation();try{var result=f.apply(this,arguments)}finally{--nestedOperation||endOperation()}return result}}for(var ext in extensions)extensions.propertyIsEnumerable(ext)&&!instance.propertyIsEnumerable(ext)&&(instance[ext]=extensions[ext]);return instance}CodeMirror.defaults={value:"",mode:null,theme:"default",indentUnit:2,indentWithTabs:!1,smartIndent:!0,tabSize:4,keyMap:"default",extraKeys:null,electricChars:!0,autoClearEmptyLines:!1,onKeyEvent:null,lineWrapping:!1,lineNumbers:!1,gutter:!1,fixedGutter:!1,firstLineNumber:1,readOnly:!1,onChange:null,onCursorActivity:null,onGutterClick:null,onHighlightComplete:null,onUpdate:null,onFocus:null,onBlur:null,onScroll:null,matchBrackets:!1,workTime:100,workDelay:200,pollInterval:100,undoDepth:40,tabindex:null};var ios=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),mac=ios||/Mac/.test(navigator.platform),win=/Win/.test(navigator.platform),modes={},mimeModes={};CodeMirror.defineMode=function(name,mode){!CodeMirror.defaults.mode&&name!="null"&&(CodeMirror.defaults.mode=name),modes[name]=mode},CodeMirror.defineMIME=function(mime,spec){mimeModes[mime]=spec},CodeMirror.resolveMode=function(spec){if(typeof spec=="string"&&mimeModes.hasOwnProperty(spec))spec=mimeModes[spec];else if(typeof spec=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(spec))return CodeMirror.resolveMode("application/xml");return typeof spec=="string"?{name:spec}:spec||{name:"null"}},CodeMirror.getMode=function(options,spec){var spec=CodeMirror.resolveMode(spec),mfactory=modes[spec.name];return mfactory?mfactory(options,spec):(window.console&&console.warn("No mode "+spec.name+" found, falling back to plain text."),CodeMirror.getMode(options,"text/plain"))},CodeMirror.listModes=function(){var list=[];for(var m in modes)modes.propertyIsEnumerable(m)&&list.push(m);return list},CodeMirror.listMIMEs=function(){var list=[];for(var m in mimeModes)mimeModes.propertyIsEnumerable(m)&&list.push({mime:m,mode:mimeModes[m]});return list};var extensions=CodeMirror.extensions={};CodeMirror.defineExtension=function(name,func){extensions[name]=func};var commands=CodeMirror.commands={selectAll:function(cm){cm.setSelection({line:0,ch:0},{line:cm.lineCount()-1})},killLine:function(cm){var from=cm.getCursor(!0),to=cm.getCursor(!1),sel=!posEq(from,to);!sel&&cm.getLine(from.line).length==from.ch?cm.replaceRange("",from,{line:from.line+1,ch:0}):cm.replaceRange("",from,sel?to:{line:from.line})},deleteLine:function(cm){var l=cm.getCursor().line;cm.replaceRange("",{line:l,ch:0},{line:l})},undo:function(cm){cm.undo()},redo:function(cm){cm.redo()},goDocStart:function(cm){cm.setCursor(0,0,!0)},goDocEnd:function(cm){cm.setSelection({line:cm.lineCount()-1},null,!0)},goLineStart:function(cm){cm.setCursor(cm.getCursor().line,0,!0)},goLineStartSmart:function(cm){var cur=cm.getCursor(),text=cm.getLine(cur.line),firstNonWS=Math.max(0,text.search(/\S/));cm.setCursor(cur.line,cur.ch<=firstNonWS&&cur.ch?0:firstNonWS,!0)},goLineEnd:function(cm){cm.setSelection({line:cm.getCursor().line},null,!0)},goLineUp:function(cm){cm.moveV(-1,"line")},goLineDown:function(cm){cm.moveV(1,"line")},goPageUp:function(cm){cm.moveV(-1,"page")},goPageDown:function(cm){cm.moveV(1,"page")},goCharLeft:function(cm){cm.moveH(-1,"char")},goCharRight:function(cm){cm.moveH(1,"char")},goColumnLeft:function(cm){cm.moveH(-1,"column")},goColumnRight:function(cm){cm.moveH(1,"column")},goWordLeft:function(cm){cm.moveH(-1,"word")},goWordRight:function(cm){cm.moveH(1,"word")},delCharLeft:function(cm){cm.deleteH(-1,"char")},delCharRight:function(cm){cm.deleteH(1,"char")},delWordLeft:function(cm){cm.deleteH(-1,"word")},delWordRight:function(cm){cm.deleteH(1,"word")},indentAuto:function(cm){cm.indentSelection("smart")},indentMore:function(cm){cm.indentSelection("add")},indentLess:function(cm){cm.indentSelection("subtract")},insertTab:function(cm){cm.replaceSelection("\t","end")},transposeChars:function(cm){var cur=cm.getCursor(),line=cm.getLine(cur.line);cur.ch>0&&cur.ch<line.length-1&&cm.replaceRange(line.charAt(cur.ch)+line.charAt(cur.ch-1),{line:cur.line,ch:cur.ch-1},{line:cur.line,ch:cur.ch+1})},newlineAndIndent:function(cm){cm.replaceSelection("\n","end"),cm.indentLine(cm.getCursor().line)},toggleOverwrite:function(cm){cm.toggleOverwrite()}},keyMap=CodeMirror.keyMap={};keyMap.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharRight",Backspace:"delCharLeft",Tab:"indentMore","Shift-Tab":"indentLess",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},keyMap.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goWordLeft","Ctrl-Right":"goWordRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delWordLeft","Ctrl-Delete":"delWordRight","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll",fallthrough:"basic"},keyMap.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goWordLeft","Alt-Right":"goWordRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delWordLeft","Ctrl-Alt-Backspace":"delWordRight","Alt-Delete":"delWordRight","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll",fallthrough:["basic","emacsy"]},keyMap["default"]=mac?keyMap.macDefault:keyMap.pcDefault,keyMap.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageUp","Shift-Ctrl-V":"goPageDown","Ctrl-D":"delCharRight","Ctrl-H":"delCharLeft","Alt-D":"delWordRight","Alt-Backspace":"delWordLeft","Ctrl-K":"killLine","Ctrl-T":"transposeChars"};function getKeyMap(val){return typeof val=="string"?keyMap[val]:val}function lookupKey(name,extraMap,map,handle){function lookup(map){map=getKeyMap(map);var found=map[name];if(found!=null&&handle(found))return!0;if(map.catchall)return handle(map.catchall);var fallthrough=map.fallthrough;if(fallthrough==null)return!1;if(Object.prototype.toString.call(fallthrough)!="[object Array]")return lookup(fallthrough);for(var i=0,e=fallthrough.length;i<e;++i)if(lookup(fallthrough[i]))return!0;return!1}return extraMap&&lookup(extraMap)?!0:lookup(map)}function isModifierKey(event){var name=keyNames[e_prop(event,"keyCode")];return name=="Ctrl"||name=="Alt"||name=="Shift"||name=="Mod"}CodeMirror.fromTextArea=function(textarea,options){options||(options={}),options.value=textarea.value,!options.tabindex&&textarea.tabindex&&(options.tabindex=textarea.tabindex);function save(){textarea.value=instance.getValue()}if(textarea.form){var rmSubmit=connect(textarea.form,"submit",save,!0);if(typeof textarea.form.submit=="function"){var realSubmit=textarea.form.submit;function wrappedSubmit(){save(),textarea.form.submit=realSubmit,textarea.form.submit(),textarea.form.submit=wrappedSubmit}textarea.form.submit=wrappedSubmit}}textarea.style.display="none";var instance=CodeMirror(function(node){textarea.parentNode.insertBefore(node,textarea.nextSibling)},options);return instance.save=save,instance.getTextArea=function(){return textarea},instance.toTextArea=function(){save(),textarea.parentNode.removeChild(instance.getWrapperElement()),textarea.style.display="",textarea.form&&(rmSubmit(),typeof textarea.form.submit=="function"&&(textarea.form.submit=realSubmit))},instance};function copyState(mode,state){if(state===!0)return state;if(mode.copyState)return mode.copyState(state);var nstate={};for(var n in state){var val=state[n];val instanceof Array&&(val=val.concat([])),nstate[n]=val}return nstate}CodeMirror.copyState=copyState;function startState(mode,a1,a2){return mode.startState?mode.startState(a1,a2):!0}CodeMirror.startState=startState;function StringStream(string,tabSize){this.pos=this.start=0,this.string=string,this.tabSize=tabSize||8}StringStream.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==0},peek:function(){return this.string.charAt(this.pos)},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(match){var ch=this.string.charAt(this.pos);if(typeof match=="string")var ok=ch==match;else var ok=ch&&(match.test?match.test(ch):match(ch));if(ok)return++this.pos,ch},eatWhile:function(match){var start=this.pos;while(this.eat(match));return this.pos>start},eatSpace:function(){var start=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos)))++this.pos;return this.pos>start},skipToEnd:function(){this.pos=this.string.length},skipTo:function(ch){var found=this.string.indexOf(ch,this.pos);if(found>-1)return this.pos=found,!0},backUp:function(n){this.pos-=n},column:function(){return countColumn(this.string,this.start,this.tabSize)},indentation:function(){return countColumn(this.string,null,this.tabSize)},match:function(pattern,consume,caseInsensitive){if(typeof pattern!="string"){var match=this.string.slice(this.pos).match(pattern);return match&&consume!==!1&&(this.pos+=match[0].length),match}function cased(str){return caseInsensitive?str.toLowerCase():str}if(cased(this.string).indexOf(cased(pattern),this.pos)==this.pos)return consume!==!1&&(this.pos+=pattern.length),!0},current:function(){return this.string.slice(this.start,this.pos)}},CodeMirror.StringStream=StringStream;function MarkedText(from,to,className,set){this.from=from,this.to=to,this.style=className,this.set=set}MarkedText.prototype={attach:function(line){this.set.push(line)},detach:function(line){var ix=indexOf(this.set,line);ix>-1&&this.set.splice(ix,1)},split:function(pos,lenBefore){if(this.to<=pos&&this.to!=null)return null;var from=this.from<pos||this.from==null?null:this.from-pos+lenBefore,to=this.to==null?null:this.to-pos+lenBefore;return new MarkedText(from,to,this.style,this.set)},dup:function(){return new MarkedText(null,null,this.style,this.set)},clipTo:function(fromOpen,from,toOpen,to,diff){fromOpen&&to>this.from&&(to<this.to||this.to==null)?this.from=null:this.from!=null&&this.from>=from&&(this.from=Math.max(to,this.from)+diff),toOpen&&(from<this.to||this.to==null)&&(from>this.from||this.from==null)?this.to=null:this.to!=null&&this.to>from&&(this.to=to<this.to?this.to+diff:from)},isDead:function(){return this.from!=null&&this.to!=null&&this.from>=this.to},sameSet:function(x){return this.set==x.set}};function Bookmark(pos){this.from=pos,this.to=pos,this.line=null}Bookmark.prototype={attach:function(line){this.line=line},detach:function(line){this.line==line&&(this.line=null)},split:function(pos,lenBefore){if(pos<this.from)return this.from=this.to=this.from-pos+lenBefore,this},isDead:function(){return this.from>this.to},clipTo:function(fromOpen,from,toOpen,to,diff){(fromOpen||from<this.from)&&(toOpen||to>this.to)?(this.from=0,this.to=-1):this.from>from&&(this.from=this.to=Math.max(to,this.from)+diff)},sameSet:function(x){return!1},find:function(){return!this.line||!this.line.parent?null:{line:lineNo(this.line),ch:this.from}},clear:function(){if(this.line){var found=indexOf(this.line.marked,this);found!=-1&&this.line.marked.splice(found,1),this.line=null}}};function Line(text,styles){this.styles=styles||[text,null],this.text=text,this.height=1,this.marked=this.gutterMarker=this.className=this.bgClassName=this.handlers=null,this.stateAfter=this.parent=this.hidden=null}Line.inheritMarks=function(text,orig){var ln=new Line(text),mk=orig&&orig.marked;if(mk)for(var i=0;i<mk.length;++i)if(mk[i].to==null&&mk[i].style){var newmk=ln.marked||(ln.marked=[]),mark=mk[i],nmark=mark.dup();newmk.push(nmark),nmark.attach(ln)}return ln},Line.prototype={replace:function(from,to_,text){var st=[],mk=this.marked,to=to_==null?this.text.length:to_;copyStyles(0,from,this.styles,st),text&&st.push(text,null),copyStyles(to,this.text.length,this.styles,st),this.styles=st,this.text=this.text.slice(0,from)+text+this.text.slice(to),this.stateAfter=null;if(mk){var diff=text.length-(to-from);for(var i=0;i<mk.length;++i){var mark=mk[i];mark.clipTo(from==null,from||0,to_==null,to,diff),mark.isDead()&&(mark.detach(this),mk.splice(i--,1))}}},split:function(pos,textBefore){var st=[textBefore,null],mk=this.marked;copyStyles(pos,this.text.length,this.styles,st);var taken=new Line(textBefore+this.text.slice(pos),st);if(mk)for(var i=0;i<mk.length;++i){var mark=mk[i],newmark=mark.split(pos,textBefore.length);newmark&&(taken.marked||(taken.marked=[]),taken.marked.push(newmark),newmark.attach(taken),newmark==mark&&mk.splice(i--,1))}return taken},append:function(line){var mylen=this.text.length,mk=line.marked,mymk=this.marked;this.text+=line.text,copyStyles(0,line.text.length,line.styles,this.styles);if(mymk)for(var i=0;i<mymk.length;++i)mymk[i].to==null&&(mymk[i].to=mylen);if(mk&&mk.length){mymk||(this.marked=mymk=[]);outer:for(var i=0;i<mk.length;++i){var mark=mk[i];if(!mark.from)for(var j=0;j<mymk.length;++j){var mymark=mymk[j];if(mymark.to==mylen&&mymark.sameSet(mark)){mymark.to=mark.to==null?null:mark.to+mylen,mymark.isDead()&&(mymark.detach(this),mk.splice(i--,1));continue outer}}mymk.push(mark),mark.attach(this),mark.from+=mylen,mark.to!=null&&(mark.to+=mylen)}}},fixMarkEnds:function(other){var mk=this.marked,omk=other.marked;if(!mk)return;for(var i=0;i<mk.length;++i){var mark=mk[i],close=mark.to==null;if(close&&omk)for(var j=0;j<omk.length;++j)if(omk[j].sameSet(mark)){close=!1;break}close&&(mark.to=this.text.length)}},fixMarkStarts:function(){var mk=this.marked;if(!mk)return;for(var i=0;i<mk.length;++i)mk[i].from==null&&(mk[i].from=0)},addMark:function(mark){mark.attach(this),this.marked==null&&(this.marked=[]),this.marked.push(mark),this.marked.sort(function(a,b){return(a.from||0)-(b.from||0)})},highlight:function(mode,state,tabSize){var stream=new StringStream(this.text,tabSize),st=this.styles,pos=0,changed=!1,curWord=st[0],prevWord;this.text==""&&mode.blankLine&&mode.blankLine(state);while(!stream.eol()){var style=mode.token(stream,state),substr=this.text.slice(stream.start,stream.pos);stream.start=stream.pos,pos&&st[pos-1]==style?st[pos-2]+=substr:substr&&(!changed&&(st[pos+1]!=style||pos&&st[pos-2]!=prevWord)&&(changed=!0),st[pos++]=substr,st[pos++]=style,prevWord=curWord,curWord=st[pos]);if(stream.pos>5e3){st[pos++]=this.text.slice(stream.pos),st[pos++]=null;break}}return st.length!=pos&&(st.length=pos,changed=!0),pos&&st[pos-2]!=prevWord&&(changed=!0),changed||(st.length<5&&this.text.length<10?null:!1)},getTokenAt:function(mode,state,ch){var txt=this.text,stream=new StringStream(txt);while(stream.pos<ch&&!stream.eol()){stream.start=stream.pos;var style=mode.token(stream,state)}return{start:stream.start,end:stream.pos,string:stream.current(),className:style||null,state:state}},indentation:function(tabSize){return countColumn(this.text,null,tabSize)},getHTML:function(makeTab,endAt){var html=[],first=!0,col=0;function span(text,style){if(!text)return;first&&ie&&text.charAt(0)==" "&&(text=" "+text.slice(1)),first=!1;if(text.indexOf("\t")==-1){col+=text.length;var escaped=htmlEscape(text)}else{var escaped="";for(var pos=0;;){var idx=text.indexOf("\t",pos);if(idx==-1){escaped+=htmlEscape(text.slice(pos)),col+=text.length-pos;break}col+=idx-pos;var tab=makeTab(col);escaped+=htmlEscape(text.slice(pos,idx))+tab.html,col+=tab.width,pos=idx+1}}style?html.push('<span class="',style,'">',escaped,"</span>"):html.push(escaped)}var st=this.styles,allText=this.text,marked=this.marked,len=allText.length;endAt!=null&&(len=Math.min(endAt,len));function styleToClass(style){return style?"cm-"+style.replace(/ +/g
," cm-"):null}if(!allText&&endAt==null)span(" ");else if(!marked||!marked.length)for(var i=0,ch=0;ch<len;i+=2){var str=st[i],style=st[i+1],l=str.length;ch+l>len&&(str=str.slice(0,len-ch)),ch+=l,span(str,styleToClass(style))}else{var pos=0,i=0,text="",style,sg=0,nextChange=marked[0].from||0,marks=[],markpos=0;function advanceMarks(){var m;while(markpos<marked.length&&((m=marked[markpos]).from==pos||m.from==null))m.style!=null&&marks.push(m),++markpos;nextChange=markpos<marked.length?marked[markpos].from:Infinity;for(var i=0;i<marks.length;++i){var to=marks[i].to||Infinity;to==pos?marks.splice(i--,1):nextChange=Math.min(to,nextChange)}}var m=0;while(pos<len){nextChange==pos&&advanceMarks();var upto=Math.min(len,nextChange);for(;;){if(text){var end=pos+text.length,appliedStyle=style;for(var j=0;j<marks.length;++j)appliedStyle=(appliedStyle?appliedStyle+" ":"")+marks[j].style;span(end>upto?text.slice(0,upto-pos):text,appliedStyle);if(end>=upto){text=text.slice(upto-pos),pos=upto;break}pos=end}text=st[i++],style=styleToClass(st[i++])}}}return html.join("")},cleanUp:function(){this.parent=null;if(this.marked)for(var i=0,e=this.marked.length;i<e;++i)this.marked[i].detach(this)}};function copyStyles(from,to,source,dest){for(var i=0,pos=0,state=0;pos<to;i+=2){var part=source[i],end=pos+part.length;state==0?(end>from&&dest.push(part.slice(from-pos,Math.min(part.length,to-pos)),source[i+1]),end>=from&&(state=1)):state==1&&(end>to?dest.push(part.slice(0,to-pos),source[i+1]):dest.push(part,source[i+1])),pos=end}}function LeafChunk(lines){this.lines=lines,this.parent=null;for(var i=0,e=lines.length,height=0;i<e;++i)lines[i].parent=this,height+=lines[i].height;this.height=height}LeafChunk.prototype={chunkSize:function(){return this.lines.length},remove:function(at,n,callbacks){for(var i=at,e=at+n;i<e;++i){var line=this.lines[i];this.height-=line.height,line.cleanUp();if(line.handlers)for(var j=0;j<line.handlers.length;++j)callbacks.push(line.handlers[j])}this.lines.splice(at,n)},collapse:function(lines){lines.splice.apply(lines,[lines.length,0].concat(this.lines))},insertHeight:function(at,lines,height){this.height+=height,this.lines.splice.apply(this.lines,[at,0].concat(lines));for(var i=0,e=lines.length;i<e;++i)lines[i].parent=this},iterN:function(at,n,op){for(var e=at+n;at<e;++at)if(op(this.lines[at]))return!0}};function BranchChunk(children){this.children=children;var size=0,height=0;for(var i=0,e=children.length;i<e;++i){var ch=children[i];size+=ch.chunkSize(),height+=ch.height,ch.parent=this}this.size=size,this.height=height,this.parent=null}BranchChunk.prototype={chunkSize:function(){return this.size},remove:function(at,n,callbacks){this.size-=n;for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var rm=Math.min(n,sz-at),oldHeight=child.height;child.remove(at,rm,callbacks),this.height-=oldHeight-child.height,sz==rm&&(this.children.splice(i--,1),child.parent=null);if((n-=rm)==0)break;at=0}else at-=sz}if(this.size-n<25){var lines=[];this.collapse(lines),this.children=[new LeafChunk(lines)],this.children[0].parent=this}},collapse:function(lines){for(var i=0,e=this.children.length;i<e;++i)this.children[i].collapse(lines)},insert:function(at,lines){var height=0;for(var i=0,e=lines.length;i<e;++i)height+=lines[i].height;this.insertHeight(at,lines,height)},insertHeight:function(at,lines,height){this.size+=lines.length,this.height+=height;for(var i=0,e=this.children.length;i<e;++i){var child=this.children[i],sz=child.chunkSize();if(at<=sz){child.insertHeight(at,lines,height);if(child.lines&&child.lines.length>50){while(child.lines.length>50){var spilled=child.lines.splice(child.lines.length-25,25),newleaf=new LeafChunk(spilled);child.height-=newleaf.height,this.children.splice(i+1,0,newleaf),newleaf.parent=this}this.maybeSpill()}break}at-=sz}},maybeSpill:function(){if(this.children.length<=10)return;var me=this;do{var spilled=me.children.splice(me.children.length-5,5),sibling=new BranchChunk(spilled);if(!me.parent){var copy=new BranchChunk(me.children);copy.parent=me,me.children=[copy,sibling],me=copy}else{me.size-=sibling.size,me.height-=sibling.height;var myIndex=indexOf(me.parent.children,me);me.parent.children.splice(myIndex+1,0,sibling)}sibling.parent=me.parent}while(me.children.length>10);me.parent.maybeSpill()},iter:function(from,to,op){this.iterN(from,to-from,op)},iterN:function(at,n,op){for(var i=0,e=this.children.length;i<e;++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var used=Math.min(n,sz-at);if(child.iterN(at,used,op))return!0;if((n-=used)==0)break;at=0}else at-=sz}}};function getLineAt(chunk,n){while(!chunk.lines)for(var i=0;;++i){var child=chunk.children[i],sz=child.chunkSize();if(n<sz){chunk=child;break}n-=sz}return chunk.lines[n]}function lineNo(line){if(line.parent==null)return null;var cur=line.parent,no=indexOf(cur.lines,line);for(var chunk=cur.parent;chunk;cur=chunk,chunk=chunk.parent)for(var i=0,e=chunk.children.length;;++i){if(chunk.children[i]==cur)break;no+=chunk.children[i].chunkSize()}return no}function lineAtHeight(chunk,h){var n=0;outer:do{for(var i=0,e=chunk.children.length;i<e;++i){var child=chunk.children[i],ch=child.height;if(h<ch){chunk=child;continue outer}h-=ch,n+=child.chunkSize()}return n}while(!chunk.lines);for(var i=0,e=chunk.lines.length;i<e;++i){var line=chunk.lines[i],lh=line.height;if(h<lh)break;h-=lh}return n+i}function heightAtLine(chunk,n){var h=0;outer:do{for(var i=0,e=chunk.children.length;i<e;++i){var child=chunk.children[i],sz=child.chunkSize();if(n<sz){chunk=child;continue outer}n-=sz,h+=child.height}return h}while(!chunk.lines);for(var i=0;i<n;++i)h+=chunk.lines[i].height;return h}function History(){this.time=0,this.done=[],this.undone=[]}History.prototype={addChange:function(start,added,old){this.undone.length=0;var time=+(new Date),cur=this.done[this.done.length-1],last=cur&&cur[cur.length-1],dtime=time-this.time;if(dtime>400||!last)this.done.push([{start:start,added:added,old:old}]);else if(last.start>start+old.length||last.start+last.added<start-last.added+last.old.length)cur.push({start:start,added:added,old:old});else{var oldoff=0;if(start<last.start){for(var i=last.start-start-1;i>=0;--i)last.old.unshift(old[i]);oldoff=Math.min(0,added-old.length),last.added+=last.start-start+oldoff,last.start=start}else last.start<start&&(oldoff=start-last.start,added+=oldoff);for(var i=last.added-oldoff,e=old.length;i<e;++i)last.old.push(old[i]);last.added<added&&(last.added=added)}this.time=time}};function stopMethod(){e_stop(this)}function addStop(event){return event.stop||(event.stop=stopMethod),event}function e_preventDefault(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function e_stopPropagation(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function e_stop(e){e_preventDefault(e),e_stopPropagation(e)}CodeMirror.e_stop=e_stop,CodeMirror.e_preventDefault=e_preventDefault,CodeMirror.e_stopPropagation=e_stopPropagation;function e_target(e){return e.target||e.srcElement}function e_button(e){if(e.which)return e.which;if(e.button&1)return 1;if(e.button&2)return 3;if(e.button&4)return 2}function e_prop(e,prop){var overridden=e.override&&e.override.hasOwnProperty(prop);return overridden?e.override[prop]:e[prop]}function connect(node,type,handler,disconnect){if(typeof node.addEventListener=="function"){node.addEventListener(type,handler,!1);if(disconnect)return function(){node.removeEventListener(type,handler,!1)}}else{var wrapHandler=function(event){handler(event||window.event)};node.attachEvent("on"+type,wrapHandler);if(disconnect)return function(){node.detachEvent("on"+type,wrapHandler)}}}CodeMirror.connect=connect;function Delayed(){this.id=null}Delayed.prototype={set:function(ms,f){clearTimeout(this.id),this.id=setTimeout(f,ms)}};var Pass=CodeMirror.Pass={toString:function(){return"CodeMirror.Pass"}},gecko=/gecko\/\d{7}/i.test(navigator.userAgent),ie=/MSIE \d/.test(navigator.userAgent),ie_lt9=/MSIE [1-8]\b/.test(navigator.userAgent),webkit=/WebKit\//.test(navigator.userAgent),chrome=/Chrome\//.test(navigator.userAgent),dragAndDrop=function(){if(ie_lt9)return!1;var div=document.createElement("div");return"draggable"in div||"dragDrop"in div}(),lineSep="\n";(function(){var te=document.createElement("textarea");te.value="foo\nbar",te.value.indexOf("\r")>-1&&(lineSep="\r\n")})();function countColumn(string,end,tabSize){end==null&&(end=string.search(/[^\s\u00a0]/),end==-1&&(end=string.length));for(var i=0,n=0;i<end;++i)string.charAt(i)=="\t"?n+=tabSize-n%tabSize:++n;return n}function computedStyle(elt){return elt.currentStyle?elt.currentStyle:window.getComputedStyle(elt,null)}function eltOffset(node,screen){var bod=node.ownerDocument.body,x=0,y=0,skipBody=!1;for(var n=node;n;n=n.offsetParent){var ol=n.offsetLeft,ot=n.offsetTop;n==bod?(x+=Math.abs(ol),y+=Math.abs(ot)):(x+=ol,y+=ot),screen&&computedStyle(n).position=="fixed"&&(skipBody=!0)}var e=screen&&!skipBody?null:bod;for(var n=node.parentNode;n!=e;n=n.parentNode)n.scrollLeft!=null&&(x-=n.scrollLeft,y-=n.scrollTop);return{left:x,top:y}}document.documentElement.getBoundingClientRect!=null&&(eltOffset=function(node,screen){try{var box=node.getBoundingClientRect();box={top:box.top,left:box.left}}catch(e){box={top:0,left:0}}if(!screen)if(window.pageYOffset==null){var t=document.documentElement||document.body.parentNode;t.scrollTop==null&&(t=document.body),box.top+=t.scrollTop,box.left+=t.scrollLeft}else box.top+=window.pageYOffset,box.left+=window.pageXOffset;return box});function eltText(node){return node.textContent||node.innerText||node.nodeValue||""}function selectInput(node){ios?(node.selectionStart=0,node.selectionEnd=node.value.length):node.select()}function posEq(a,b){return a.line==b.line&&a.ch==b.ch}function posLess(a,b){return a.line<b.line||a.line==b.line&&a.ch<b.ch}function copyPos(x){return{line:x.line,ch:x.ch}}var escapeElement=document.createElement("pre");function htmlEscape(str){return escapeElement.textContent=str,escapeElement.innerHTML}htmlEscape("a")=="\na"?htmlEscape=function(str){return escapeElement.textContent=str,escapeElement.innerHTML.slice(1)}:htmlEscape("\t")!="\t"&&(htmlEscape=function(str){return escapeElement.innerHTML="",escapeElement.appendChild(document.createTextNode(str)),escapeElement.innerHTML}),CodeMirror.htmlEscape=htmlEscape;function editEnd(from,to){if(!to)return 0;if(!from)return to.length;for(var i=from.length,j=to.length;i>=0&&j>=0;--i,--j)if(from.charAt(i)!=to.charAt(j))break;return j+1}function indexOf(collection,elt){if(collection.indexOf)return collection.indexOf(elt);for(var i=0,e=collection.length;i<e;++i)if(collection[i]==elt)return i;return-1}function isWordChar(ch){return/\w/.test(ch)||ch.toUpperCase()!=ch.toLowerCase()}var splitLines="\n\nb".split(/\n/).length!=3?function(string){var pos=0,nl,result=[];while((nl=string.indexOf("\n",pos))>-1)result.push(string.slice(pos,string.charAt(nl-1)=="\r"?nl-1:nl)),pos=nl+1;return result.push(string.slice(pos)),result}:function(string){return string.split(/\r?\n/)};CodeMirror.splitLines=splitLines;var hasSelection=window.getSelection?function(te){try{return te.selectionStart!=te.selectionEnd}catch(e){return!1}}:function(te){try{var range=te.ownerDocument.selection.createRange()}catch(e){}return!range||range.parentElement()!=te?!1:range.compareEndPoints("StartToEnd",range)!=0};CodeMirror.defineMode("null",function(){return{token:function(stream){stream.skipToEnd()}}}),CodeMirror.defineMIME("text/plain","null");var keyNames={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};return CodeMirror.keyNames=keyNames,function(){for(var i=0;i<10;i++)keyNames[i+48]=String(i);for(var i=65;i<=90;i++)keyNames[i]=String.fromCharCode(i);for(var i=1;i<=12;i++)keyNames[i+111]=keyNames[i+63235]="F"+i}(),CodeMirror}();
// xml
CodeMirror.defineMode("xml",function(config,parserConfig){var indentUnit=config.indentUnit,Kludges=parserConfig.htmlMode?{autoSelfClosers:{br:!0,img:!0,hr:!0,link:!0,input:!0,meta:!0,col:!0,frame:!0,base:!0,area:!0},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!1}:{autoSelfClosers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1},alignCDATA=parserConfig.alignCDATA,tagName,type;function inText(stream,state){function chain(parser){return state.tokenize=parser,parser(stream,state)}var ch=stream.next();if(ch=="<"){if(stream.eat("!"))return stream.eat("[")?stream.match("CDATA[")?chain(inBlock("atom","]]>")):null:stream.match("--")?chain(inBlock("comment","-->")):stream.match("DOCTYPE",!0,!0)?(stream.eatWhile(/[\w\._\-]/),chain(doctype(1))):null;if(stream.eat("?"))return stream.eatWhile(/[\w\._\-]/),state.tokenize=inBlock("meta","?>"),"meta";type=stream.eat("/")?"closeTag":"openTag",stream.eatSpace(),tagName="";var c;while(c=stream.eat(/[^\s\u00a0=<>\"\'\/?]/))tagName+=c;return state.tokenize=inTag,"tag"}if(ch=="&"){var ok;return stream.eat("#")?stream.eat("x")?ok=stream.eatWhile(/[a-fA-F\d]/)&&stream.eat(";"):ok=stream.eatWhile(/[\d]/)&&stream.eat(";"):ok=stream.eatWhile(/[\w\.\-:]/)&&stream.eat(";"),ok?"atom":"error"}return stream.eatWhile(/[^&<]/),null}function inTag(stream,state){var ch=stream.next();return ch==">"||ch=="/"&&stream.eat(">")?(state.tokenize=inText,type=ch==">"?"endTag":"selfcloseTag","tag"):ch=="="?(type="equals",null):/[\'\"]/.test(ch)?(state.tokenize=inAttribute(ch),state.tokenize(stream,state)):(stream.eatWhile(/[^\s\u00a0=<>\"\'\/?]/),"word")}function inAttribute(quote){return function(stream,state){while(!stream.eol())if(stream.next()==quote){state.tokenize=inTag;break}return"string"}}function inBlock(style,terminator){return function(stream,state){while(!stream.eol()){if(stream.match(terminator)){state.tokenize=inText;break}stream.next()}return style}}function doctype(depth){return function(stream,state){var ch;while((ch=stream.next())!=null){if(ch=="<")return state.tokenize=doctype(depth+1),state.tokenize(stream,state);if(ch==">"){if(depth==1){state.tokenize=inText;break}return state.tokenize=doctype(depth-1),state.tokenize(stream,state)}}return"meta"}}var curState,setStyle;function pass(){for(var i=arguments.length-1;i>=0;i--)curState.cc.push(arguments[i])}function cont(){return pass.apply(null,arguments),!0}function pushContext(tagName,startOfLine){var noIndent=Kludges.doNotIndent.hasOwnProperty(tagName)||curState.context&&curState.context.noIndent;curState.context={prev:curState.context,tagName:tagName,indent:curState.indented,startOfLine:startOfLine,noIndent:noIndent}}function popContext(){curState.context&&(curState.context=curState.context.prev)}function element(type){if(type=="openTag")return curState.tagName=tagName,cont(attributes,endtag(curState.startOfLine));if(type=="closeTag"){var err=!1;return curState.context?err=curState.context.tagName!=tagName:err=!0,err&&(setStyle="error"),cont(endclosetag(err))}return cont()}function endtag(startOfLine){return function(type){return type=="selfcloseTag"||type=="endTag"&&Kludges.autoSelfClosers.hasOwnProperty(curState.tagName.toLowerCase())?cont():type=="endTag"?(pushContext(curState.tagName,startOfLine),cont()):cont()}}function endclosetag(err){return function(type){return err&&(setStyle="error"),type=="endTag"?(popContext(),cont()):(setStyle="error",cont(arguments.callee))}}function attributes(type){return type=="word"?(setStyle="attribute",cont(attribute,attributes)):type=="endTag"||type=="selfcloseTag"?pass():(setStyle="error",cont(attributes))}function attribute(type){return type=="equals"?cont(attvalue,attributes):(Kludges.allowMissing||(setStyle="error"),type=="endTag"||type=="selfcloseTag"?pass():cont())}function attvalue(type){return type=="string"?cont(attvaluemaybe):type=="word"&&Kludges.allowUnquoted?(setStyle="string",cont()):(setStyle="error",type=="endTag"||type=="selfCloseTag"?pass():cont())}function attvaluemaybe(type){return type=="string"?cont(attvaluemaybe):pass()}return{startState:function(){return{tokenize:inText,cc:[],indented:0,startOfLine:!0,tagName:null,context:null}},token:function(stream,state){stream.sol()&&(state.startOfLine=!0,state.indented=stream.indentation());if(stream.eatSpace())return null;setStyle=type=tagName=null;var style=state.tokenize(stream,state);state.type=type;if((style||type)&&style!="comment"){curState=state;for(;;){var comb=state.cc.pop()||element;if(comb(type||style))break}}return state.startOfLine=!1,setStyle||style},indent:function(state,textAfter,fullLine){var context=state.context;if(state.tokenize!=inTag&&state.tokenize!=inText||context&&context.noIndent)return fullLine?fullLine.match(/^(\s*)/)[0].length:0;if(alignCDATA&&/<!\[CDATA\[/.test(textAfter))return 0;context&&/^<\//.test(textAfter)&&(context=context.prev);while(context&&!context.startOfLine)context=context.prev;return context?context.indent+indentUnit:0},compareStates:function(a,b){if(a.indented!=b.indented||a.tokenize!=b.tokenize)return!1;for(var ca=a.context,cb=b.context;;ca=ca.prev,cb=cb.prev){if(!ca||!cb)return ca==cb;if(ca.tagName!=cb.tagName)return!1}},electricChars:"/"}}),CodeMirror.defineMIME("application/xml","xml"),CodeMirror.defineMIME("text/html",{name:"xml",htmlMode:!0});
// javascript
CodeMirror.defineMode("javascript",function(config,parserConfig){var indentUnit=config.indentUnit,jsonMode=parserConfig.json,keywords=function(){function kw(type){return{type:type,style:"keyword"}}var A=kw("keyword a"),B=kw("keyword b"),C=kw("keyword c"),operator=kw("operator"),atom={type:"atom",style:"atom"};return{"if":A,"while":A,"with":A,"else":B,"do":B,"try":B,"finally":B,"return":C,"break":C,"continue":C,"new":C,"delete":C,"throw":C,"var":kw("var"),"const":kw("var"),let:kw("var"),"function":kw("function"),"catch":kw("catch"),"for":kw("for"),"switch":kw("switch"),"case":kw("case"),"default":kw("default"),"in":operator,"typeof":operator,"instanceof":operator,"true":atom,"false":atom,"null":atom,"undefined":atom,NaN:atom,Infinity:atom}}(),isOperatorChar=/[+\-*&%=<>!?|]/;function chain(stream,state,f){return state.tokenize=f,f(stream,state)}function nextUntilUnescaped(stream,end){var escaped=!1,next;while((next=stream.next())!=null){if(next==end&&!escaped)return!1;escaped=!escaped&&next=="\\"}return escaped}var type,content;function ret(tp,style,cont){return type=tp,content=cont,style}function jsTokenBase(stream,state){var ch=stream.next();if(ch=='"'||ch=="'")return chain(stream,state,jsTokenString(ch));if(/[\[\]{}\(\),;\:\.]/.test(ch))return ret(ch);if(ch=="0"&&stream.eat(/x/i))return stream.eatWhile(/[\da-f]/i),ret("number","number");if(/\d/.test(ch))return stream.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),ret("number","number");if(ch=="/")return stream.eat("*")?chain(stream,state,jsTokenComment):stream.eat("/")?(stream.skipToEnd(),ret("comment","comment")):state.reAllowed?(nextUntilUnescaped(stream,"/"),stream.eatWhile(/[gimy]/),ret("regexp","string-2")):(stream.eatWhile(isOperatorChar),ret("operator",null,stream.current()));if(ch=="#")return stream.skipToEnd(),ret("error","error");if(isOperatorChar.test(ch))return stream.eatWhile(isOperatorChar),ret("operator",null,stream.current());stream.eatWhile(/[\w\$_]/);var word=stream.current(),known=keywords.propertyIsEnumerable(word)&&keywords[word];return known&&state.kwAllowed?ret(known.type,known.style,word):ret("variable","variable",word)}function jsTokenString(quote){return function(stream,state){return nextUntilUnescaped(stream,quote)||(state.tokenize=jsTokenBase),ret("string","string")}}function jsTokenComment(stream,state){var maybeEnd=!1,ch;while(ch=stream.next()){if(ch=="/"&&maybeEnd){state.tokenize=jsTokenBase;break}maybeEnd=ch=="*"}return ret("comment","comment")}var atomicTypes={atom:!0,number:!0,variable:!0,string:!0,regexp:!0};function JSLexical(indented,column,type,align,prev,info){this.indented=indented,this.column=column,this.type=type,this.prev=prev,this.info=info,align!=null&&(this.align=align)}function inScope(state,varname){for(var v=state.localVars;v;v=v.next)if(v.name==varname)return!0}function parseJS(state,style,type,content,stream){var cc=state.cc;cx.state=state,cx.stream=stream,cx.marked=null,cx.cc=cc,state.lexical.hasOwnProperty("align")||(state.lexical.align=!0);for(;;){var combinator=cc.length?cc.pop():jsonMode?expression:statement;if(combinator(type,content)){while(cc.length&&cc[cc.length-1].lex)cc.pop()();return cx.marked?cx.marked:type=="variable"&&inScope(state,content)?"variable-2":style}}}var cx={state:null,column:null,marked:null,cc:null};function pass(){for(var i=arguments.length-1;i>=0;i--)cx.cc.push(arguments[i])}function cont(){return pass.apply(null,arguments),!0}function register(varname){var state=cx.state;if(state.context){cx.marked="def";for(var v=state.localVars;v;v=v.next)if(v.name==varname)return;state.localVars={name:varname,next:state.localVars}}}var defaultVars={name:"this",next:{name:"arguments"}};function pushcontext(){cx.state.context||(cx.state.localVars=defaultVars),cx.state.context={prev:cx.state.context,vars:cx.state.localVars}}function popcontext(){cx.state.localVars=cx.state.context.vars,cx.state.context=cx.state.context.prev}function pushlex(type,info){var result=function(){var state=cx.state;state.lexical=new JSLexical(state.indented,cx.stream.column(),type,null,state.lexical,info)};return result.lex=!0,result}function poplex(){var state=cx.state;state.lexical.prev&&(state.lexical.type==")"&&(state.indented=state.lexical.indented),state.lexical=state.lexical.prev)}poplex.lex=!0;function expect(wanted){return function expecting(type){return type==wanted?cont():wanted==";"?pass():cont(arguments.callee)}}function statement(type){return type=="var"?cont(pushlex("vardef"),vardef1,expect(";"),poplex):type=="keyword a"?cont(pushlex("form"),expression,statement,poplex):type=="keyword b"?cont(pushlex("form"),statement,poplex):type=="{"?cont(pushlex("}"),block,poplex):type==";"?cont():type=="function"?cont(functiondef):type=="for"?cont(pushlex("form"),expect("("),pushlex(")"),forspec1,expect(")"),poplex,statement,poplex):type=="variable"?cont(pushlex("stat"),maybelabel):type=="switch"?cont(pushlex("form"),expression,pushlex("}","switch"),expect("{"),block,poplex,poplex):type=="case"?cont(expression,expect(":")):type=="default"?cont(expect(":")):type=="catch"?cont(pushlex("form"),pushcontext,expect("("),funarg,expect(")"),statement,poplex,popcontext):pass(pushlex("stat"),expression,expect(";"),poplex)}function expression(type){return atomicTypes.hasOwnProperty(type)?cont(maybeoperator):type=="function"?cont(functiondef):type=="keyword c"?cont(maybeexpression):type=="("?cont(pushlex(")"),maybeexpression,expect(")"),poplex,maybeoperator):type=="operator"?cont(expression):type=="["?cont(pushlex("]"),commasep(expression,"]"),poplex,maybeoperator):type=="{"?cont(pushlex("}"),commasep(objprop,"}"),poplex,maybeoperator):cont()}function maybeexpression(type){return type.match(/[;\}\)\],]/)?pass():pass(expression)}function maybeoperator(type,value){if(type=="operator"&&/\+\+|--/.test(value))return cont(maybeoperator);if(type=="operator")return cont(expression);if(type==";")return;if(type=="(")return cont(pushlex(")"),commasep(expression,")"),poplex,maybeoperator);if(type==".")return cont(property,maybeoperator);if(type=="[")return cont(pushlex("]"),expression,expect("]"),poplex,maybeoperator)}function maybelabel(type){return type==":"?cont(poplex,statement):pass(maybeoperator,expect(";"),poplex)}function property(type){if(type=="variable")return cx.marked="property",cont()}function objprop(type){type=="variable"&&(cx.marked="property");if(atomicTypes.hasOwnProperty(type))return cont(expect(":"),expression)}function commasep(what,end){function proceed(type){return type==","?cont(what,proceed):type==end?cont():cont(expect(end))}return function commaSeparated(type){return type==end?cont():pass(what,proceed)}}function block(type){return type=="}"?cont():pass(statement,block)}function vardef1(type,value){return type=="variable"?(register(value),cont(vardef2)):cont()}function vardef2(type,value){if(value=="=")return cont(expression,vardef2);if(type==",")return cont(vardef1)}function forspec1(type){return type=="var"?cont(vardef1,forspec2):type==";"?pass(forspec2):type=="variable"?cont(formaybein):pass(forspec2)}function formaybein(type,value){return value=="in"?cont(expression):cont(maybeoperator,forspec2)}function forspec2(type,value){return type==";"?cont(forspec3):value=="in"?cont(expression):cont(expression,expect(";"),forspec3)}function forspec3(type){type!=")"&&cont(expression)}function functiondef(type,value){if(type=="variable")return register(value),cont(functiondef);if(type=="(")return cont(pushlex(")"),pushcontext,commasep(funarg,")"),poplex,statement,popcontext)}function funarg(type,value){if(type=="variable")return register(value),cont()}return{startState:function(basecolumn){return{tokenize:jsTokenBase,reAllowed:!0,kwAllowed:!0,cc:[],lexical:new JSLexical((basecolumn||0)-indentUnit,0,"block",!1),localVars:null,context:null,indented:0}},token:function(stream,state){stream.sol()&&(state.lexical.hasOwnProperty("align")||(state.lexical.align=!1),state.indented=stream.indentation());if(stream.eatSpace())return null;var style=state.tokenize(stream,state);return type=="comment"?style:(state.reAllowed=type=="operator"||type=="keyword c"||!!type.match(/^[\[{}\(,;:]$/),state.kwAllowed=type!=".",parseJS(state,style,type,content,stream))},indent:function(state,textAfter){if(state.tokenize!=jsTokenBase)return 0;var firstChar=textAfter&&textAfter.charAt(0),lexical=state.lexical,type=lexical.type,closing=firstChar==type;return type=="vardef"?lexical.indented+4:type=="form"&&firstChar=="{"?lexical.indented:type=="stat"||type=="form"?lexical.indented+indentUnit:lexical.info=="switch"&&!closing?lexical.indented+(/^(?:case|default)\b/.test(textAfter)?indentUnit:2*indentUnit):lexical.align?lexical.column+(closing?0:1):lexical.indented+(closing?0:indentUnit)},electricChars:":{}"}}),CodeMirror.defineMIME("text/javascript","javascript"),CodeMirror.defineMIME("application/json",{name:"javascript",json:!0});
// css
CodeMirror.defineMode("css",function(config){var indentUnit=config.indentUnit,type;function ret(style,tp){return type=tp,style}function tokenBase(stream,state){var ch=stream.next();if(ch=="@")return stream.eatWhile(/[\w\\\-]/),ret("meta",stream.current());if(ch=="/"&&stream.eat("*"))return state.tokenize=tokenCComment,tokenCComment(stream,state);if(ch=="<"&&stream.eat("!"))return state.tokenize=tokenSGMLComment,tokenSGMLComment(stream,state);if(ch!="=")return ch!="~"&&ch!="|"||!stream.eat("=")?ch=='"'||ch=="'"?(state.tokenize=tokenString(ch),state.tokenize(stream,state)):ch=="#"?(stream.eatWhile(/[\w\\\-]/),ret("atom","hash")):ch=="!"?(stream.match(/^\s*\w*/),ret("keyword","important")):/\d/.test(ch)?(stream.eatWhile(/[\w.%]/),ret("number","unit")):/[,.+>*\/]/.test(ch)?ret(null,"select-op"):/[;{}:\[\]]/.test(ch)?ret(null,ch):(stream.eatWhile(/[\w\\\-]/),ret("variable","variable")):ret(null,"compare");ret(null,"compare")}function tokenCComment(stream,state){var maybeEnd=!1,ch;while((ch=stream.next())!=null){if(maybeEnd&&ch=="/"){state.tokenize=tokenBase;break}maybeEnd=ch=="*"}return ret("comment","comment")}function tokenSGMLComment(stream,state){var dashes=0,ch;while((ch=stream.next())!=null){if(dashes>=2&&ch==">"){state.tokenize=tokenBase;break}dashes=ch=="-"?dashes+1:0}return ret("comment","comment")}function tokenString(quote){return function(stream,state){var escaped=!1,ch;while((ch=stream.next())!=null){if(ch==quote&&!escaped)break;escaped=!escaped&&ch=="\\"}return escaped||(state.tokenize=tokenBase),ret("string","string")}}return{startState:function(base){return{tokenize:tokenBase,baseIndent:base||0,stack:[]}},token:function(stream,state){if(stream.eatSpace())return null;var style=state.tokenize(stream,state),context=state.stack[state.stack.length-1];if(type=="hash"&&context!="rule")style="string-2";else if(style=="variable")if(context=="rule")style="number";else if(!context||context=="@media{")style="tag";return context=="rule"&&/^[\{\};]$/.test(type)&&state.stack.pop(),type=="{"?context=="@media"?state.stack[state.stack.length-1]="@media{":state.stack.push("{"):type=="}"?state.stack.pop():type=="@media"?state.stack.push("@media"):context=="{"&&type!="comment"&&state.stack.push("rule"),style},indent:function(state,textAfter){var n=state.stack.length;return/^\}/.test(textAfter)&&(n-=state.stack[state.stack.length-1]=="rule"?2:1),state.baseIndent+n*indentUnit},electricChars:"}"}}),CodeMirror.defineMIME("text/css","css");
// htmlmixed
CodeMirror.defineMode("htmlmixed",function(config,parserConfig){var htmlMode=CodeMirror.getMode(config,{name:"xml",htmlMode:!0}),jsMode=CodeMirror.getMode(config,"javascript"),cssMode=CodeMirror.getMode(config,"css");function html(stream,state){var style=htmlMode.token(stream,state.htmlState);return style=="tag"&&stream.current()==">"&&state.htmlState.context&&(/^script$/i.test(state.htmlState.context.tagName)?(state.token=javascript,state.localState=jsMode.startState(htmlMode.indent(state.htmlState,"")),state.mode="javascript"):/^style$/i.test(state.htmlState.context.tagName)&&(state.token=css,state.localState=cssMode.startState(htmlMode.indent(state.htmlState,"")),state.mode="css")),style}function maybeBackup(stream,pat,style){var cur=stream.current(),close=cur.search(pat);return close>-1&&stream.backUp(cur.length-close),style}function javascript(stream,state){return stream.match(/^<\/\s*script\s*>/i,!1)?(state.token=html,state.localState=null,state.mode="html",html(stream,state)):maybeBackup(stream,/<\/\s*script\s*>/,jsMode.token(stream,state.localState))}function css(stream,state){return stream.match(/^<\/\s*style\s*>/i,!1)?(state.token=html,state.localState=null,state.mode="html",html(stream,state)):maybeBackup(stream,/<\/\s*style\s*>/,cssMode.token(stream,state.localState))}return{startState:function(){var state=htmlMode.startState();return{token:html,localState:null,mode:"html",htmlState:state}},copyState:function(state){if(state.localState)var local=CodeMirror.copyState(state.token==css?cssMode:jsMode,state.localState);return{token:state.token,localState:local,mode:state.mode,htmlState:CodeMirror.copyState(htmlMode,state.htmlState)}},token:function(stream,state){return state.token(stream,state)},indent:function(state,textAfter){return state.token==html||/^\s*<\//.test(textAfter)?htmlMode.indent(state.htmlState,textAfter):state.token==javascript?jsMode.indent(state.localState,textAfter):cssMode.indent(state.localState,textAfter)},compareStates:function(a,b){return htmlMode.compareStates(a.htmlState,b.htmlState)},electricChars:"/{}:"}}),CodeMirror.defineMIME("text/html","htmlmixed");
// clike
CodeMirror.defineMode("clike",function(config,parserConfig){var indentUnit=config.indentUnit,keywords=parserConfig.keywords||{},blockKeywords=parserConfig.blockKeywords||{},atoms=parserConfig.atoms||{},hooks=parserConfig.hooks||{},multiLineStrings=parserConfig.multiLineStrings,isOperatorChar=/[+\-*&%=<>!?|\/]/,curPunc;function tokenBase(stream,state){var ch=stream.next();if(hooks[ch]){var result=hooks[ch](stream,state);if(result!==!1)return result}if(ch=='"'||ch=="'")return state.tokenize=tokenString(ch),state.tokenize(stream,state);if(/[\[\]{}\(\),;\:\.]/.test(ch))return curPunc=ch,null;if(/\d/.test(ch))return stream.eatWhile(/[\w\.]/),"number";if(ch=="/"){if(stream.eat("*"))return state.tokenize=tokenComment,tokenComment(stream,state);if(stream.eat("/"))return stream.skipToEnd(),"comment"}if(isOperatorChar.test(ch))return stream.eatWhile(isOperatorChar),"operator";stream.eatWhile(/[\w\$_]/);var cur=stream.current();return keywords.propertyIsEnumerable(cur)?(blockKeywords.propertyIsEnumerable(cur)&&(curPunc="newstatement"),"keyword"):atoms.propertyIsEnumerable(cur)?"atom":"word"}function tokenString(quote){return function(stream,state){var escaped=!1,next,end=!1;while((next=stream.next())!=null){if(next==quote&&!escaped){end=!0;break}escaped=!escaped&&next=="\\"}if(end||!escaped&&!multiLineStrings)state.tokenize=null;return"string"}}function tokenComment(stream,state){var maybeEnd=!1,ch;while(ch=stream.next()){if(ch=="/"&&maybeEnd){state.tokenize=null;break}maybeEnd=ch=="*"}return"comment"}function Context(indented,column,type,align,prev){this.indented=indented,this.column=column,this.type=type,this.align=align,this.prev=prev}function pushContext(state,col,type){return state.context=new Context(state.indented,col,type,null,state.context)}function popContext(state){var t=state.context.type;if(t==")"||t=="]"||t=="}")state.indented=state.context.indented;return state.context=state.context.prev}return{startState:function(basecolumn){return{tokenize:null,context:new Context((basecolumn||0)-indentUnit,0,"top",!1),indented:0,startOfLine:!0}},token:function(stream,state){var ctx=state.context;stream.sol()&&(ctx.align==null&&(ctx.align=!1),state.indented=stream.indentation(),state.startOfLine=!0);if(stream.eatSpace())return null;curPunc=null;var style=(state.tokenize||tokenBase)(stream,state);if(style=="comment"||style=="meta")return style;ctx.align==null&&(ctx.align=!0);if(curPunc!=";"&&curPunc!=":"||ctx.type!="statement")if(curPunc=="{")pushContext(state,stream.column(),"}");else if(curPunc=="[")pushContext(state,stream.column(),"]");else if(curPunc=="(")pushContext(state,stream.column(),")");else if(curPunc=="}"){while(ctx.type=="statement")ctx=popContext(state);ctx.type=="}"&&(ctx=popContext(state));while(ctx.type=="statement")ctx=popContext(state)}else curPunc==ctx.type?popContext(state):(ctx.type=="}"||ctx.type=="top"||ctx.type=="statement"&&curPunc=="newstatement")&&pushContext(state,stream.column(),"statement");else popContext(state);return state.startOfLine=!1,style},indent:function(state,textAfter){if(state.tokenize!=tokenBase&&state.tokenize!=null)return 0;var ctx=state.context,firstChar=textAfter&&textAfter.charAt(0);ctx.type=="statement"&&firstChar=="}"&&(ctx=ctx.prev);var closing=firstChar==ctx.type;return ctx.type=="statement"?ctx.indented+(firstChar=="{"?0:indentUnit):ctx.align?ctx.column+(closing?0:1):ctx.indented+(closing?0:indentUnit)},electricChars:"{}"}}),function(){function words(str){var obj={},words=str.split(" ");for(var i=0;i<words.length;++i)obj[words[i]]=!0;return obj}var cKeywords="auto if break int case long char register continue return default short do sizeof double static else struct entry switch extern typedef float union for unsigned goto while enum void const signed volatile";function cppHook(stream,state){return state.startOfLine?(stream.skipToEnd(),"meta"):!1}function tokenAtString(stream,state){var next;while((next=stream.next())!=null)if(next=='"'&&!stream.eat('"')){state.tokenize=null;break}return"string"}CodeMirror.defineMIME("text/x-csrc",{name:"clike",keywords:words(cKeywords),blockKeywords:words("case do else for if switch while struct"),atoms:words("null"),hooks:{"#":cppHook}}),CodeMirror.defineMIME("text/x-c++src",{name:"clike",keywords:words(cKeywords+" asm dynamic_cast namespace reinterpret_cast try bool explicit new "+"static_cast typeid catch operator template typename class friend private "+"this using const_cast inline public throw virtual delete mutable protected "+"wchar_t"),blockKeywords:words("catch class do else finally for if struct switch try while"),atoms:words("true false null"),hooks:{"#":cppHook}}),CodeMirror.defineMIME("text/x-java",{name:"clike",keywords:words("abstract assert boolean break byte case catch char class const continue default do double else enum extends final finally float for goto if implements import instanceof int interface long native new package private protected public return short static strictfp super switch synchronized this throw throws transient try void volatile while"),blockKeywords:words("catch class do else finally for if switch try while"),atoms:words("true false null"),hooks:{"@":function(stream,state){return stream.eatWhile(/[\w\$_]/),"meta"}}}),CodeMirror.defineMIME("text/x-csharp",{name:"clike",keywords:words("abstract as base bool break byte case catch char checked class const continue decimal default delegate do double else enum event explicit extern finally fixed float for foreach goto if implicit in int interface internal is lock long namespace new object operator out override params private protected public readonly ref return sbyte sealed short sizeof stackalloc static string struct switch this throw try typeof uint ulong unchecked unsafe ushort using virtual void volatile while add alias ascending descending dynamic from get global group into join let orderby partial remove select set value var yield"),blockKeywords:words("catch class do else finally for foreach if struct switch try while"),atoms:words("true false null"),hooks:{"@":function(stream,state){return stream.eat('"')?(state.tokenize=tokenAtString,tokenAtString(stream,state)):(stream.eatWhile(/[\w\$_]/),"meta")}}})}();
// php
(function(){function keywords(str){var obj={},words=str.split(" ");for(var i=0;i<words.length;++i)obj[words[i]]=!0;return obj}function heredoc(delim){return function(stream,state){return stream.match(delim)?state.tokenize=null:stream.skipToEnd(),"string"}}var phpConfig={name:"clike",keywords:keywords("abstract and array as break case catch class clone const continue declare default do else elseif enddeclare endfor endforeach endif endswitch endwhile extends final for foreach function global goto if implements interface instanceof namespace new or private protected public static switch throw trait try use var while xor die echo empty exit eval include include_once isset list require require_once return print unset __halt_compiler self static parent"),blockKeywords:keywords("catch do else elseif for foreach if switch try while"),atoms:keywords("true false null TRUE FALSE NULL"),multiLineStrings:!0,hooks:{$:function(stream,state){return stream.eatWhile(/[\w\$_]/),"variable-2"},"<":function(stream,state){return stream.match(/<</)?(stream.eatWhile(/[\w\.]/),state.tokenize=heredoc(stream.current().slice(3)),state.tokenize(stream,state)):!1},"#":function(stream,state){while(!stream.eol()&&!stream.match("?>",!1))stream.next();return"comment"},"/":function(stream,state){if(stream.eat("/")){while(!stream.eol()&&!stream.match("?>",!1))stream.next();return"comment"}return!1}}};CodeMirror.defineMode("php",function(config,parserConfig){var htmlMode=CodeMirror.getMode(config,{name:"xml",htmlMode:!0}),jsMode=CodeMirror.getMode(config,"javascript"),cssMode=CodeMirror.getMode(config,"css"),phpMode=CodeMirror.getMode(config,phpConfig);function dispatch(stream,state){var isPHP=state.mode=="php";stream.sol()&&state.pending!='"'&&(state.pending=null);if(state.curMode==htmlMode){if(stream.match(/^<\?\w*/))return state.curMode=phpMode,state.curState=state.php,state.curClose="?>",state.mode="php","meta";if(state.pending=='"'){while(!stream.eol()&&stream.next()!='"');var style="string"}else if(state.pending&&stream.pos<state.pending.end){stream.pos=state.pending.end;var style=state.pending.style}else var style=htmlMode.token(stream,state.curState);state.pending=null;var cur=stream.current(),openPHP=cur.search(/<\?/);return openPHP!=-1?(style=="string"&&/\"$/.test(cur)&&!/\?>/.test(cur)?state.pending='"':state.pending={end:stream.pos,style:style},stream.backUp(cur.length-openPHP)):style=="tag"&&stream.current()==">"&&state.curState.context&&(/^script$/i.test(state.curState.context.tagName)?(state.curMode=jsMode,state.curState=jsMode.startState(htmlMode.indent(state.curState,"")),state.curClose=/^<\/\s*script\s*>/i,state.mode="javascript"):/^style$/i.test(state.curState.context.tagName)&&(state.curMode=cssMode,state.curState=cssMode.startState(htmlMode.indent(state.curState,"")),state.curClose=/^<\/\s*style\s*>/i,state.mode="css")),style}return(!isPHP||state.php.tokenize==null)&&stream.match(state.curClose,isPHP)?(state.curMode=htmlMode,state.curState=state.html,state.curClose=null,state.mode="html",isPHP?"meta":dispatch(stream,state)):state.curMode.token(stream,state.curState)}return{startState:function(){var html=htmlMode.startState();return{html:html,php:phpMode.startState(),curMode:parserConfig.startOpen?phpMode:htmlMode,curState:parserConfig.startOpen?phpMode.startState():html,curClose:parserConfig.startOpen?/^\?>/:null,mode:parserConfig.startOpen?"php":"html",pending:null}},copyState:function(state){var html=state.html,htmlNew=CodeMirror.copyState(htmlMode,html),php=state.php,phpNew=CodeMirror.copyState(phpMode,php),cur;return state.curState==html?cur=htmlNew:state.curState==php?cur=phpNew:cur=CodeMirror.copyState(state.curMode,state.curState),{html:htmlNew,php:phpNew,curMode:state.curMode,curState:cur,curClose:state.curClose,mode:state.mode,pending:state.pending}},token:dispatch,indent:function(state,textAfter){return state.curMode!=phpMode&&/^\s*<\//.test(textAfter)||state.curMode==phpMode&&/^\?>/.test(textAfter)?htmlMode.indent(state.html,textAfter):state.curMode.indent(state.curState,textAfter)},electricChars:"/{}:"}}),CodeMirror.defineMIME("application/x-httpd-php","php"),CodeMirror.defineMIME("application/x-httpd-php-open",{name:"php",startOpen:!0}),CodeMirror.defineMIME("text/x-php",phpConfig)})();
// markdown
CodeMirror.defineMode("markdown",function(cmCfg,modeCfg){var htmlMode=CodeMirror.getMode(cmCfg,{name:"xml",htmlMode:!0}),header="header",code="comment",quote="quote",list="string",hr="hr",linktext="link",linkhref="string",em="em",strong="strong",emstrong="emstrong",hrRE=/^([*\-=_])(?:\s*\1){2,}\s*$/,ulRE=/^[*\-+]\s+/,olRE=/^[0-9]+\.\s+/,headerRE=/^(?:\={3,}|-{3,})$/,textRE=/^[^\[*_\\<>`]+/;function switchInline(stream,state,f){return state.f=state.inline=f,f(stream,state)}function switchBlock(stream,state,f){return state.f=state.block=f,f(stream,state)}function blankLine(state){return state.em=!1,state.strong=!1,null}function blockNormal(stream,state){var match;if(state.indentationDiff>=4)return state.indentation-=state.indentationDiff,stream.skipToEnd(),code;if(stream.eatSpace())return null;if(stream.peek()==="#"||stream.match(headerRE))state.header=!0;else if(stream.eat(">"))state.indentation++,state.quote=!0;else{if(stream.peek()==="[")return switchInline(stream,state,footnoteLink);if(stream.match(hrRE,!0))return hr;if(match=stream.match(ulRE,!0)||stream.match(olRE,!0))return state.indentation+=match[0].length,list}return switchInline(stream,state,state.inline)}function htmlBlock(stream,state){var style=htmlMode.token(stream,state.htmlState);return style==="tag"&&state.htmlState.type!=="openTag"&&!state.htmlState.context&&(state.f=inlineNormal,state.block=blockNormal),style}function getType(state){var styles=[];return state.strong?styles.push(state.em?emstrong:strong):state.em&&styles.push(em),state.header&&styles.push(header),state.quote&&styles.push(quote),styles.length?styles.join(" "):null}function handleText(stream,state){return stream.match(textRE,!0)?getType(state):undefined}function inlineNormal(stream,state){var style=state.text(stream,state);if(typeof style!="undefined")return style;var ch=stream.next();if(ch==="\\")return stream.next(),getType(state);if(ch==="`")return switchInline(stream,state,inlineElement(code,"`"));if(ch==="[")return switchInline(stream,state,linkText);if(ch==="<"&&stream.match(/^\w/,!1))return stream.backUp(1),switchBlock(stream,state,htmlBlock);var t=getType(state);return ch==="*"||ch==="_"?stream.eat(ch)?(state.strong=!state.strong)?getType(state):t:(state.em=!state.em)?getType(state):t:getType(state)}function linkText(stream,state){while(!stream.eol()){var ch=stream.next();ch==="\\"&&stream.next();if(ch==="]")return state.inline=state.f=linkHref,linktext}return linktext}function linkHref(stream,state){stream.eatSpace();var ch=stream.next();return ch==="("||ch==="["?switchInline(stream,state,inlineElement(linkhref,ch==="("?")":"]")):"error"}function footnoteLink(stream,state){return stream.match(/^[^\]]*\]:/,!0)?(state.f=footnoteUrl,linktext):switchInline(stream,state,inlineNormal)}function footnoteUrl(stream,state){return stream.eatSpace(),stream.match(/^[^\s]+/,!0),state.f=state.inline=inlineNormal,linkhref}function inlineRE(endChar){return inlineRE[endChar]||(inlineRE[endChar]=new RegExp("^(?:[^\\\\\\"+endChar+"]|\\\\.)*(?:\\"+endChar+"|$)")),inlineRE[endChar]}function inlineElement(type,endChar,next){return next=next||inlineNormal,function(stream,state){return stream.match(inlineRE(endChar)),state.inline=state.f=next,type}}return{startState:function(){return{f:blockNormal,block:blockNormal,htmlState:htmlMode.startState(),indentation:0,inline:inlineNormal,text:handleText,em:!1,strong:!1,header:!1,quote:!1}},copyState:function(s){return{f:s.f,block:s.block,htmlState:CodeMirror.copyState(htmlMode,s.htmlState),indentation:s.indentation,inline:s.inline,text:s.text,em:s.em,strong:s.strong,header:s.header,quote:s.quote}},token:function(stream,state){if(stream.sol()){if(stream.match(/^\s*$/,!0))return blankLine(state);state.header=!1,state.quote=!1,state.f=state.block;var indentation=stream.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length;state.indentationDiff=indentation-state.indentation,state.indentation=indentation;if(indentation>0)return null}return state.f(stream,state)},blankLine:blankLine,getType:getType}}),CodeMirror.defineMIME("text/x-markdown","markdown");

// dialog
(function(){function dialogDiv(cm,template){var wrap=cm.getWrapperElement(),dialog=wrap.insertBefore(document.createElement("div"),wrap.firstChild);return dialog.className="CodeMirror-dialog",dialog.innerHTML="<div>"+template+"</div>",dialog}CodeMirror.defineExtension("openDialog",function(template,callback){var dialog=dialogDiv(this,template),closed=!1,me=this;function close(){if(closed)return;closed=!0,dialog.parentNode.removeChild(dialog)}var inp=dialog.getElementsByTagName("input")[0];return inp&&(CodeMirror.connect(inp,"keydown",function(e){if(e.keyCode==13||e.keyCode==27)CodeMirror.e_stop(e),close(),me.focus(),e.keyCode==13&&callback(inp.value)}),inp.focus(),CodeMirror.connect(inp,"blur",close)),close}),CodeMirror.defineExtension("openConfirm",function(template,callbacks){var dialog=dialogDiv(this,template),buttons=dialog.getElementsByTagName("button"),closed=!1,me=this,blurring=1;function close(){if(closed)return;closed=!0,dialog.parentNode.removeChild(dialog),me.focus()}buttons[0].focus();for(var i=0;i<buttons.length;++i){var b=buttons[i];(function(callback){CodeMirror.connect(b,"click",function(e){CodeMirror.e_preventDefault(e),close(),callback&&callback(me)})})(callbacks[i]),CodeMirror.connect(b,"blur",function(){--blurring,setTimeout(function(){blurring<=0&&close()},200)}),CodeMirror.connect(b,"focus",function(){++blurring})}})})();
// search
// Define search commands. Depends on dialog.js or another
// implementation of the openDialog method.
// Replace works a little oddly -- it will do the replace on the next
// Ctrl-G (or whatever is bound to findNext) press. You prevent a
// replace by making sure the match is no longer selected when hitting
// Ctrl-G.
(function(){function SearchState(){this.posFrom=this.posTo=this.query=null,this.marked=[]}function getSearchState(cm){return cm._searchState||(cm._searchState=new SearchState)}function dialog(cm,text,shortText,f){cm.openDialog?cm.openDialog(text,f):f(prompt(shortText,""))}function confirmDialog(cm,text,shortText,fs){cm.openConfirm?cm.openConfirm(text,fs):confirm(shortText)&&fs[0]()}function parseQuery(query){var isRE=query.match(/^\/(.*)\/$/);return isRE?new RegExp(isRE[1]):query}var queryDialog='Search: <input type="text" style="width: 10em"> <span style="color: #888">(Use /re/ syntax for regexp search)</span>';function doSearch(cm,rev){var state=getSearchState(cm);if(state.query)return findNext(cm,rev);dialog(cm,queryDialog,"Search for:",function(query){cm.operation(function(){if(!query||state.query)return;state.query=parseQuery(query);if(cm.lineCount()<2e3)for(var cursor=cm.getSearchCursor(query);cursor.findNext();)state.marked.push(cm.markText(cursor.from(),cursor.to(),"CodeMirror-searching"));state.posFrom=state.posTo=cm.getCursor(),findNext(cm,rev)})})}function findNext(cm,rev){cm.operation(function(){var state=getSearchState(cm),cursor=cm.getSearchCursor(state.query,rev?state.posFrom:state.posTo);if(!cursor.find(rev)){cursor=cm.getSearchCursor(state.query,rev?{line:cm.lineCount()-1}:{line:0,ch:0});if(!cursor.find(rev))return}cm.setSelection(cursor.from(),cursor.to()),state.posFrom=cursor.from(),state.posTo=cursor.to()})}function clearSearch(cm){cm.operation(function(){var state=getSearchState(cm);if(!state.query)return;state.query=null;for(var i=0;i<state.marked.length;++i)state.marked[i].clear();state.marked.length=0})}var replaceQueryDialog='Replace: <input type="text" style="width: 10em"> <span style="color: #888">(Use /re/ syntax for regexp search)</span>',replacementQueryDialog='With: <input type="text" style="width: 10em">',doReplaceConfirm="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";function replace(cm,all){dialog(cm,replaceQueryDialog,"Replace:",function(query){if(!query)return;query=parseQuery(query),dialog(cm,replacementQueryDialog,"Replace with:",function(text){if(all)cm.operation(function(){for(var cursor=cm.getSearchCursor(query);cursor.findNext();)if(typeof query!="string"){var match=cm.getRange(cursor.from(),cursor.to()).match(query);cursor.replace(text.replace(/\$(\d)/,function(w,i){return match[i]}))}else cursor.replace(text)});else{clearSearch(cm);var cursor=cm.getSearchCursor(query,cm.getCursor());function advance(){var start=cursor.from(),match;if(!(match=cursor.findNext())){cursor=cm.getSearchCursor(query);if(!(match=cursor.findNext())||cursor.from().line==start.line&&cursor.from().ch==start.ch)return}cm.setSelection(cursor.from(),cursor.to()),confirmDialog(cm,doReplaceConfirm,"Replace?",[function(){doReplace(match)},advance])}function doReplace(match){cursor.replace(typeof query=="string"?text:text.replace(/\$(\d)/,function(w,i){return match[i]})),advance()}advance()}})})}CodeMirror.commands.find=function(cm){clearSearch(cm),doSearch(cm)},CodeMirror.commands.findNext=doSearch,CodeMirror.commands.findPrev=function(cm){doSearch(cm,!0)},CodeMirror.commands.clearSearch=clearSearch,CodeMirror.commands.replace=replace,CodeMirror.commands.replaceAll=function(cm){replace(cm,!0)}})();
// searchcursor
(function(){function SearchCursor(cm,query,pos,caseFold){this.atOccurrence=!1,this.cm=cm,caseFold==null&&(caseFold=typeof query=="string"&&query==query.toLowerCase()),pos=pos?cm.clipPos(pos):{line:0,ch:0},this.pos={from:pos,to:pos};if(typeof query!="string")this.matches=function(reverse,pos){if(reverse){var line=cm.getLine(pos.line).slice(0,pos.ch),match=line.match(query),start=0;while(match){var ind=line.indexOf(match[0]);start+=ind,line=line.slice(ind+1);var newmatch=line.match(query);if(!newmatch)break;match=newmatch,start++}}else var line=cm.getLine(pos.line).slice(pos.ch),match=line.match(query),start=match&&pos.ch+line.indexOf(match[0]);if(match)return{from:{line:pos.line,ch:start},to:{line:pos.line,ch:start+match[0].length},match:match}};else{caseFold&&(query=query.toLowerCase());var fold=caseFold?function(str){return str.toLowerCase()}:function(str){return str},target=query.split("\n");target.length==1?this.matches=function(reverse,pos){var line=fold(cm.getLine(pos.line)),len=query.length,match;if(reverse?pos.ch>=len&&(match=line.lastIndexOf(query,pos.ch-len))!=-1:(match=line.indexOf(query,pos.ch))!=-1)return{from:{line:pos.line,ch:match},to:{line:pos.line,ch:match+len}}}:this.matches=function(reverse,pos){var ln=pos.line,idx=reverse?target.length-1:0,match=target[idx],line=fold(cm.getLine(ln)),offsetA=reverse?line.indexOf(match)+match.length:line.lastIndexOf(match);if(reverse?offsetA>=pos.ch||offsetA!=match.length:offsetA<=pos.ch||offsetA!=line.length-match.length)return;for(;;){if(reverse?!ln:ln==cm.lineCount()-1)return;line=fold(cm.getLine(ln+=reverse?-1:1)),match=target[reverse?--idx:++idx];if(idx>0&&idx<target.length-1){if(line!=match)return;continue}var offsetB=reverse?line.lastIndexOf(match):line.indexOf(match)+match.length;if(reverse?offsetB!=line.length-match.length:offsetB!=match.length)return;var start={line:pos.line,ch:offsetA},end={line:ln,ch:offsetB};return{from:reverse?end:start,to:reverse?start:end}}}}}SearchCursor.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(reverse){var self=this,pos=this.cm.clipPos(reverse?this.pos.from:this.pos.to);function savePosAndFail(line){var pos={line:line,ch:0};return self.pos={from:pos,to:pos},self.atOccurrence=!1,!1}for(;;){if(this.pos=this.matches(reverse,pos))return this.atOccurrence=!0,this.pos.match||!0;if(reverse){if(!pos.line)return savePosAndFail(0);pos={line:pos.line-1,ch:this.cm.getLine(pos.line-1).length}}else{var maxLine=this.cm.lineCount();if(pos.line==maxLine-1)return savePosAndFail(maxLine);pos={line:pos.line+1,ch:0}}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(newText){var self=this;this.atOccurrence&&(self.pos.to=this.cm.replaceRange(newText,self.pos.from,self.pos.to))}},CodeMirror.defineExtension("getSearchCursor",function(query,pos,caseFold){return new SearchCursor(this,query,pos,caseFold)})})();
